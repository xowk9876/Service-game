<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ì‹¤ì‹œê°„ ì±„íŒ…</title>
    <meta name="description" content="ìµëª…ìœ¼ë¡œ ì‹¤ì‹œê°„ ì±„íŒ…í•˜ê³  ì†Œí†µí•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°">
      <meta name="keywords" content="ìµëª…ì±„íŒ…, ì‹¤ì‹œê°„ì±„íŒ…, ì»¤ë®¤ë‹ˆí‹°, ì±„íŒ…ë°©">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Tae_system">
    <meta name="theme-color" content="#667eea">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:site_name" content="ìµëª… ì±„íŒ…">
    <meta property="og:title" content="ìµëª… ì‹¤ì‹œê°„ ì±„íŒ…">
    <meta property="og:description" content="ìµëª…ìœ¼ë¡œ ì‹¤ì‹œê°„ ì±„íŒ…í•˜ê³  ì†Œí†µí•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°">
    <meta property="og:url" content="https://xowk9876.github.io/portfolio/chat.html">
    
    <!-- Favicon -->
    <link rel="icon" href="image/profile.jpg" type="image/jpeg">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .chat-container {
            width: 90%;
            max-width: 800px;
            height: 80vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .chat-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .chat-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .user-count {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .message-avatar.gradient-1 {
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
        }
        
        .message-avatar.gradient-2 {
            background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%);
        }
        
        .message-avatar.gradient-3 {
            background: linear-gradient(135deg, #ff9ff3 0%, #f368e0 100%);
        }
        
        .message-avatar.gradient-4 {
            background: linear-gradient(135deg, #54a0ff 0%, #2e86de 100%);
        }
        
        .message-avatar.gradient-5 {
            background: linear-gradient(135deg, #5f27cd 0%, #341f97 100%);
        }
        
        .message-avatar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .message-avatar:hover::before {
            transform: translateX(100%);
        }
        
        .message-content {
            flex: 1;
            background: white;
            padding: 12px 16px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .message-username {
            font-weight: 600;
            color: #667eea;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .message-time {
            font-size: 12px;
            color: #999;
        }
        
        .message-text {
            color: #333;
            line-height: 1.4;
            word-wrap: break-word;
        }
        
        .message-status {
            font-size: 12px;
            margin: 0 5px;
            opacity: 0.7;
        }
        
        .message-reactions {
            margin-top: 8px;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .reaction-btn {
            background: none;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.6;
        }
        
        .reaction-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: rgba(102, 126, 234, 0.3);
            opacity: 1;
            transform: scale(1.05);
        }
        
        .reaction-added {
            animation: reactionPop 0.3s ease-out;
        }
        
        @keyframes reactionPop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .message:hover .reaction-btn {
            opacity: 1;
        }
        
        .system-message {
            text-align: center;
            margin: 10px 0;
            font-size: 12px;
            color: #666;
            font-style: italic;
        }
        
        .typing-indicator {
            display: none;
            margin-bottom: 15px;
            padding: 10px 16px;
            background: #e9ecef;
            border-radius: 15px;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        .typing-indicator.show {
            display: block;
        }
        
        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .nickname-input {
            flex: 0 0 120px;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .nickname-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .message-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .message-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .send-button {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .send-button:active {
            transform: scale(0.95);
        }
        
        
        .setting-item {
            margin-bottom: 15px;
        }
        
        .setting-label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .setting-checkbox {
            margin-right: 8px;
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        /* ë‹¤í¬ ëª¨ë“œ */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        body.dark-mode .chat-container {
            background: rgba(30, 30, 46, 0.95);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .chat-messages {
            background: #2d3748;
        }
        
        body.dark-mode .message-content {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .message-username {
            color: #81c784;
        }
        
        body.dark-mode .message-time {
            color: #a0aec0;
        }
        
        
        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        
        body.dark-mode .message-text {
            color: #e2e8f0;
        }
        
        body.dark-mode .chat-input-container {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        body.dark-mode .nickname-input,
        body.dark-mode .message-input {
            background: #4a5568;
            border-color: #718096;
            color: #e2e8f0;
        }
        
        body.dark-mode .nickname-input:focus,
        body.dark-mode .message-input:focus {
            border-color: #81c784;
        }
        
        
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .chat-container {
                width: 95%;
                height: 90vh;
            }
            
            .chat-header {
                padding: 15px;
            }
            
            .chat-title {
                font-size: 20px;
            }
            
            .user-count {
                position: static;
                margin-top: 10px;
                display: inline-block;
            }
            
            .chat-input-wrapper {
                flex-direction: column;
                gap: 10px;
            }
            
            .nickname-input {
                flex: none;
                width: 100%;
            }
            
            .message-input {
                width: 100%;
            }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- ì±„íŒ… í—¤ë” -->
        <div class="chat-header">
            <button class="back-button" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="chat-title">ìµëª… ì±„íŒ…</h1>
            <p class="chat-subtitle">ìµëª…ìœ¼ë¡œ ì‹¤ì‹œê°„ ì±„íŒ…í•˜ì„¸ìš”</p>
            <div class="user-count" id="userCount">ğŸ˜€ (0 users)</div>
        </div>
        
        <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
        <div class="chat-messages" id="chatMessages">
            <div class="system-message">
                ìµëª… ì±„íŒ…ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ë‹‰ë„¤ì„ì„ ì„¤ì •í•˜ê³  ì±„íŒ…ì„ ì‹œì‘í•˜ì„¸ìš”.
            </div>
        </div>
        
        <!-- íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° -->
        <div class="typing-indicator" id="typingIndicator">
            <span id="typingText">ëˆ„êµ°ê°€ íƒ€ì´í•‘ ì¤‘...</span>
        </div>
        
        <!-- ì±„íŒ… ì…ë ¥ ì˜ì—­ -->
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input type="text" class="nickname-input" id="nicknameInput" placeholder="ë‹‰ë„¤ì„" maxlength="20">
                <input type="text" class="message-input" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500">
                <button class="send-button" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentNickname = '';
        let messageCount = 0;
        let isTyping = false;
        let typingTimeout;
        let userCount = 0;
        let conversationContext = [];
        let activeUsers = [];
        let userStates = new Map(); // ì‚¬ìš©ì ìƒíƒœ ê´€ë¦¬
        let conversationFlow = [];
        let lastActivityTime = Date.now();
        let isUserActive = true;
        
        // WebSocket ê´€ë ¨ ë³€ìˆ˜
        let ws = null;
        let clientId = null;
        let isConnected = false;
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ëŒ€í™” ì£¼ì œ - ê³ ê¸‰ ì§€ì‹ê³¼ ì°½ì˜ì  ì‚¬ê³ 
        let conversationTopics = {
            'ê³¼í•™ê¸°ìˆ ': {
                keywords: ['AI', 'ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'ì–‘ìì»´í“¨íŒ…', 'ë¸”ë¡ì²´ì¸', 'ë©”íƒ€ë²„ìŠ¤', 'ë¡œë´‡', 'ììœ¨ì£¼í–‰', 'IoT', 'ë¹…ë°ì´í„°', 'í´ë¼ìš°ë“œ', 'ì•Œê³ ë¦¬ì¦˜', 'í”„ë¡œê·¸ë˜ë°', 'ì½”ë”©', 'ê°œë°œ', 'ê¸°ìˆ ', 'í˜ì‹ ', 'ë””ì§€í„¸', 'ìŠ¤ë§ˆíŠ¸'],
                responses: [
                    'AIê°€ ì¸ê°„ì˜ ì°½ì˜ì„±ì„ ëŒ€ì²´í•  ìˆ˜ ìˆì„ê¹Œìš”? ì €ëŠ” ì˜¤íˆë ¤ ì¸ê°„ì˜ ì ì¬ë ¥ì„ ê·¹ëŒ€í™”í•˜ëŠ” ë„êµ¬ë¼ê³  ìƒê°í•´ìš”.',
                    'ì–‘ìì»´í“¨íŒ…ì´ ìƒìš©í™”ë˜ë©´ ì•”í˜¸í™” ì‹œìŠ¤í…œì´ ì™„ì „íˆ ë°”ë€” í…ë°, ì •ë§ í¥ë¯¸ë¡œìš´ ì‹œëŒ€ê°€ ì˜¬ ê²ƒ ê°™ì•„ìš”.',
                    'ë©”íƒ€ë²„ìŠ¤ì—ì„œì˜ ì‚¬íšŒì  ìƒí˜¸ì‘ìš©ì´ ì‹¤ì œë³´ë‹¤ ë” ê¹Šì–´ì§ˆ ìˆ˜ë„ ìˆê² ë„¤ìš”. ê°€ìƒí˜„ì‹¤ì˜ ì‹¬ë¦¬í•™ì  ì˜í–¥ì´ ê¶ê¸ˆí•´ìš”.',
                    'ë¸”ë¡ì²´ì¸ ê¸°ìˆ ì´ ë‹¨ìˆœíˆ ì•”í˜¸í™”íë¥¼ ë„˜ì–´ì„œ ì‚¬íšŒ ì¸í”„ë¼ë¥¼ ë°”ê¿€ ìˆ˜ ìˆë‹¤ê³  ë´…ë‹ˆë‹¤.',
                    'ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ í¸í–¥ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ AI ìœ¤ë¦¬ì˜ í•µì‹¬ì´ì—ìš”.',
                    'ììœ¨ì£¼í–‰ì°¨ì˜ ìœ¤ë¦¬ì  ë”œë ˆë§ˆ - ëˆ„êµ¬ë¥¼ êµ¬í•´ì•¼ í• ì§€ AIê°€ ê²°ì •í•˜ëŠ” ìˆœê°„ì´ ì˜¬ ê±°ì˜ˆìš”.',
                    'IoT ë””ë°”ì´ìŠ¤ë“¤ì´ ë§Œë“¤ì–´ë‚´ëŠ” ë°ì´í„°ì˜ í™ìˆ˜ ì†ì—ì„œ ê°œì¸ì •ë³´ ë³´í˜¸ëŠ” ì–´ë–»ê²Œ í• ê¹Œìš”?',
                    'í´ë¼ìš°ë“œ ì»´í“¨íŒ…ì´ ê°€ì ¸ì˜¨ ë¯¼ì£¼í™” íš¨ê³¼ê°€ ì •ë§ ëŒ€ë‹¨í•´ìš”. ëˆ„êµ¬ë‚˜ ê°•ë ¥í•œ ì»´í“¨íŒ… ìì›ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆì£ .',
                    'ì•Œê³ ë¦¬ì¦˜ì˜ íˆ¬ëª…ì„±ê³¼ ì„¤ëª…ê°€ëŠ¥ì„±ì´ ì¤‘ìš”í•œ ì´ìŠˆê°€ ë˜ê³  ìˆì–´ìš”.',
                    'ë¹…ë°ì´í„° ë¶„ì„ìœ¼ë¡œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” íŒ¨í„´ë“¤ì´ ì •ë§ ë†€ë¼ì›Œìš”.'
                ],
                followUps: [
                    'ê·¸ ê¸°ìˆ ì˜ ì‚¬íšŒì  íŒŒê¸‰íš¨ê³¼ëŠ” ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?',
                    'ë¯¸ë˜ì— ì–´ë–¤ ë³€í™”ê°€ ì˜ˆìƒë˜ë‚˜ìš”?',
                    'ì´ ë¶„ì•¼ì—ì„œ ì¼í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ì–´ë–¤ ì¤€ë¹„ê°€ í•„ìš”í• ê¹Œìš”?',
                    'ìœ¤ë¦¬ì  ì¸¡ë©´ì—ì„œ ê³ ë ¤í•´ì•¼ í•  ì ì€ ë­˜ê¹Œìš”?'
                ]
            },
            'ì² í•™ì‚¬ê³ ': {
                keywords: ['ì² í•™', 'ìƒê°', 'ì˜ë¯¸', 'ì¡´ì¬', 'ì§„ì‹¤', 'ê°€ì¹˜', 'ìœ¤ë¦¬', 'ë„ë•', 'ì •ì˜', 'ììœ ', 'ì˜ì§€', 'ì˜ì‹', 'í˜„ì‹¤', 'ê°€ìƒ', 'ì‹œê°„', 'ê³µê°„', 'ì¸ìƒ', 'ëª©ì ', 'ê¿ˆ', 'í¬ë§'],
                responses: [
                    'í”Œë¼í†¤ì˜ ë™êµ´ì˜ ë¹„ìœ ì²˜ëŸ¼, ìš°ë¦¬ê°€ ë³´ëŠ” í˜„ì‹¤ì´ ì§„ì§œ í˜„ì‹¤ì¼ê¹Œìš”?',
                    'ì¹¸íŠ¸ì˜ ì •ì–¸ëª…ë ¹ - "ë„¤ ì˜ì§€ì˜ ì¤€ì¹™ì´ í•­ìƒ ë™ì‹œì— ë³´í¸ì  ì…ë²•ì˜ ì›ë¦¬ê°€ ë˜ë„ë¡ í–‰ìœ„í•˜ë¼"ëŠ” ë§ì´ ì •ë§ ê¹Šì–´ìš”.',
                    'ë°ì¹´ë¥´íŠ¸ì˜ "ë‚˜ëŠ” ìƒê°í•œë‹¤, ê³ ë¡œ ì¡´ì¬í•œë‹¤"ì—ì„œ ì‹œì‘ëœ ê·¼ëŒ€ ì² í•™ì˜ ì—¬ì •ì´ ì¸ìƒì ì´ì—ìš”.',
                    'ë‹ˆì²´ì˜ "ì‹ ì€ ì£½ì—ˆë‹¤"ëŠ” ì„ ì–¸ì´ ê°€ì ¸ì˜¨ ê°€ì¹˜ê´€ì˜ ì „í™˜ì„ ì–´ë–»ê²Œ ë°›ì•„ë“¤ì—¬ì•¼ í• ê¹Œìš”?',
                    'ì‹¤ì¡´ì£¼ì˜ìë“¤ì´ ë§í•˜ëŠ” "ì¡´ì¬ê°€ ë³¸ì§ˆì— ì•ì„ ë‹¤"ëŠ” ê²ƒì´ í˜„ëŒ€ì¸ì˜ ì‚¶ì— ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œìš”?',
                    'ë™ì–‘ì² í•™ì˜ "ë„"ì™€ ì„œì–‘ì² í•™ì˜ "ë¡œê³ ìŠ¤"ëŠ” ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€ìš”?',
                    'ë²„íŠ¸ëŸ°ë“œ ëŸ¬ì…€ì˜ "ì² í•™ì˜ ë¬¸ì œë“¤"ì„ ì½ìœ¼ë©´ì„œ í˜„ì‹¤ê³¼ ì´ìƒì˜ ê´´ë¦¬ì— ëŒ€í•´ ìƒê°í•´ë´¤ì–´ìš”.',
                    'í¬ìŠ¤íŠ¸ëª¨ë”ë‹ˆì¦˜ì˜ ìƒëŒ€ì£¼ì˜ê°€ ê°€ì ¸ì˜¨ í˜¼ë€ê³¼ ê¸°íšŒë¥¼ ì–´ë–»ê²Œ ë³¼ê¹Œìš”?',
                    'í™˜ê²½ìœ¤ë¦¬ì—ì„œ ë§í•˜ëŠ” "ê¹Šì€ ìƒíƒœí•™"ì˜ ê´€ì ì´ ì •ë§ í¥ë¯¸ë¡œì›Œìš”.',
                    'ê°€ìƒí˜„ì‹¤ì—ì„œì˜ ê²½í—˜ì´ ì‹¤ì œ ê²½í—˜ê³¼ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ ì² í•™ì ìœ¼ë¡œ ì ‘ê·¼í•´ë³´ë©´ ì¬ë¯¸ìˆì„ ê²ƒ ê°™ì•„ìš”.'
                ],
                followUps: [
                    'ì´ëŸ° ìƒê°ì´ ì¼ìƒìƒí™œì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ë‚˜ìš”?',
                    'ë‹¤ë¥¸ ì² í•™ìë“¤ì˜ ê²¬í•´ëŠ” ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€ìš”?',
                    'í˜„ëŒ€ ì‚¬íšŒì—ì„œ ì´ëŸ° ì² í•™ì  ì‚¬ê³ ê°€ ì™œ ì¤‘ìš”í•œê°€ìš”?',
                    'ê°œì¸ì ìœ¼ë¡œ ì–´ë–¤ ì² í•™ìê°€ ê°€ì¥ ì¸ìƒì ì´ì—ˆë‚˜ìš”?'
                ]
            },
            'ì˜ˆìˆ ì°½ì‘': {
                keywords: ['ì˜ˆìˆ ', 'ë¯¸ìˆ ', 'ìŒì•…', 'ë¬¸í•™', 'ì˜í™”', 'ë“œë¼ë§ˆ', 'ì±…', 'ì†Œì„¤', 'ì‹œ', 'ê·¸ë¦¼', 'ì‚¬ì§„', 'ë””ìì¸', 'ì°½ì‘', 'í‘œí˜„', 'ì•„ë¦„ë‹¤ì›€', 'ê°ì„±', 'ì˜ê°', 'ìƒìƒë ¥', 'ì°½ì˜ì„±', 'ì‘í’ˆ'],
                responses: [
                    'ë°˜ ê³ íì˜ "ë³„ì´ ë¹›ë‚˜ëŠ” ë°¤"ì„ ë³´ë©´ ë‹¨ìˆœí•œ í’ê²½í™”ê°€ ì•„ë‹ˆë¼ ë‚´ë©´ì˜ ê°ì •ì´ í­ë°œí•˜ëŠ” ìˆœê°„ì„ ë‹´ê³  ìˆë‹¤ëŠ” ê±¸ ëŠê»´ìš”.',
                    'ëª¨ì°¨ë¥´íŠ¸ì˜ ìŒì•…ì—ì„œ ë°œê²¬í•˜ëŠ” ìˆ˜í•™ì  ì™„ë²½í•¨ê³¼ ê°ì •ì  ê¹Šì´ê°€ ì¡°í™”ë¥¼ ì´ë£¬ ê²Œ ì •ë§ ì‹ ê¸°í•´ìš”.',
                    'ë³´ë¥´í—¤ìŠ¤ì˜ "ì•Œë ˆí”„"ë¥¼ ì½ìœ¼ë©´ì„œ ë¬´í•œê³¼ ìœ í•œì˜ ê²½ê³„ì—ì„œ ëŠë¼ëŠ” ë‘ë ¤ì›€ê³¼ ê²½ì´ë¡œì›€ì´ ì¸ìƒì ì´ì—ˆì–´ìš”.',
                    'ì¿ ë¸Œë¦­ì˜ "2001: ìŠ¤í˜ì´ìŠ¤ ì˜¤ë””ì„¸ì´"ê°€ 50ë…„ ì „ì— ë§Œë“  ì˜í™”ì¸ë° ì§€ê¸ˆ ë´ë„ ë¯¸ë˜ì ì´ì—ìš”.',
                    'ë°”íì˜ í‘¸ê°€ì—ì„œ ë°œê²¬í•˜ëŠ” ëŒ€ìœ„ë²•ì˜ ì™„ë²½í•¨ì´ ì •ë§ ê²½ì´ë¡œì›Œìš”.',
                    'í”¼ì¹´ì†Œê°€ "ì•„ë¹„ë‡½ì˜ ì²˜ë…€ë“¤"ì—ì„œ ì‹œì‘í•œ ì…ì²´ì£¼ì˜ê°€ ì˜ˆìˆ ì˜ íŒ¨ëŸ¬ë‹¤ì„ì„ ì™„ì „íˆ ë°”ê¿¨ì£ .',
                    'ì¡°ì´ìŠ¤ì˜ "ìœ¨ë¦¬ì‹œìŠ¤"ë¥¼ ì½ìœ¼ë©´ì„œ ì–¸ì–´ì˜ í•œê³„ë¥¼ ë„˜ì–´ì„œë ¤ëŠ” ì‹œë„ê°€ ì •ë§ ëŒ€ë‹¨í•´ìš”.',
                    'ì•ˆí†¤ ì²´í˜¸í”„ì˜ ë‹¨í¸ì†Œì„¤ì—ì„œ ë°œê²¬í•˜ëŠ” ì¸ê°„ ë‚´ë©´ì˜ ë¯¸ë¬˜í•œ ê°ì •ë“¤ì´ ì •ë§ ì„¬ì„¸í•´ìš”.',
                    'ìŠ¤í‹°ë¸Œ ì¡ìŠ¤ê°€ ì• í”Œ ì œí’ˆì—ì„œ ì¶”êµ¬í•œ "ë‹¨ìˆœí•¨ì˜ ë¯¸í•™"ì´ ì •ë§ ì¸ìƒì ì´ì—ìš”.',
                    'ë¯¸ì¼ˆë€ì ¤ë¡œì˜ "ë‹¤ë¹„ë“œ" ìƒì—ì„œ ë°œê²¬í•˜ëŠ” ì™„ë²½í•œ ë¹„ë¡€ì™€ ì—­ë™ì„±ì´ ê²½ì´ë¡œì›Œìš”.'
                ],
                followUps: [
                    'ì´ ì‘í’ˆì´ ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ê°ì •ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¤ë‚˜ìš”?',
                    'ì‘ê°€ì˜ ì˜ë„ì™€ ê´€ê°ì˜ í•´ì„ì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•˜ì„¸ìš”?',
                    'í˜„ëŒ€ ì˜ˆìˆ ì—ì„œ ì´ëŸ° ì „í†µì ì¸ ë¯¸í•™ì´ ì–´ë–»ê²Œ ë³€í•˜ê³  ìˆë‚˜ìš”?',
                    'ì§ì ‘ ì°½ì‘í•´ë³´ì‹  ê²½í—˜ì´ ìˆìœ¼ì‹ ê°€ìš”?'
                ]
            },
            'ì‹¬ë¦¬í•™': {
                keywords: ['ì‹¬ë¦¬', 'ë§ˆìŒ', 'ê°ì •', 'ê¸°ë¶„', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'ìš°ìš¸', 'ë¶ˆì•ˆ', 'í–‰ë³µ', 'ì‚¬ë‘', 'ê´€ê³„', 'ì†Œí†µ', 'ì´í•´', 'ê³µê°', 'ì¹˜ë£Œ', 'ìƒë‹´', 'ì˜ì‹', 'ë¬´ì˜ì‹', 'ê¿ˆ', 'ê¸°ì–µ', 'í•™ìŠµ'],
                responses: [
                    'í”„ë¡œì´íŠ¸ì˜ ë¬´ì˜ì‹ ì´ë¡ ì´ í˜„ëŒ€ ì‹¬ë¦¬í•™ì˜ ê¸°ì´ˆê°€ ë˜ì—ˆì§€ë§Œ, ì¸ì§€ì‹¬ë¦¬í•™ì˜ ë°œì „ìœ¼ë¡œ ë§ì€ ë¶€ë¶„ì´ ì¬í•´ì„ë˜ê³  ìˆì–´ìš”.',
                    'ë§ˆìŠ¬ë¡œìš°ì˜ ìš•êµ¬ë‹¨ê³„ì„¤ì—ì„œ ìì•„ì‹¤í˜„ì˜ ìµœê³  ë‹¨ê³„ì— ë„ë‹¬í•˜ëŠ” ì‚¬ëŒì´ ì •ë§ ë“œë¬¼ë‹¤ëŠ” ê²Œ ì¸ìƒì ì´ì—ìš”.',
                    'ìŠ¤í‚¤ë„ˆì˜ ì¡°ì‘ì  ì¡°ê±´í˜•ì„±ì´ ì¼ìƒìƒí™œì—ì„œ ì–´ë–»ê²Œ ì‘ìš©í•˜ëŠ”ì§€ ê´€ì°°í•´ë³´ë©´ ì •ë§ í¥ë¯¸ë¡œì›Œìš”.',
                    'ì¹¼ ìœµì˜ ì§‘ë‹¨ë¬´ì˜ì‹ê³¼ ì›í˜• ì´ë¡ ì´ í˜„ëŒ€ ë¬¸í™” ë¶„ì„ì— ì–´ë–»ê²Œ ì ìš©ë˜ëŠ”ì§€ ê¶ê¸ˆí•´ìš”.',
                    'ì—ë¦­ ì—ë¦­ìŠ¨ì˜ ì‹¬ë¦¬ì‚¬íšŒì  ë°œë‹¬ë‹¨ê³„ì—ì„œ ì²­ë…„ê¸°ì˜ ì •ì²´ì„± í˜¼ë€ì´ ì •ë§ ì¤‘ìš”í•œ ì‹œê¸°ì¸ ê²ƒ ê°™ì•„ìš”.',
                    'ì¸ì§€ë¶€ì¡°í™” ì´ë¡ ìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” í˜„ìƒë“¤ì´ ì¼ìƒì—ì„œ ì •ë§ ë§ì•„ìš”.',
                    'ì• ì°©ì´ë¡ ì´ ì„±ì¸ ê´€ê³„ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì •ë§ ê¹Šì–´ìš”.',
                    'ê¸ì •ì‹¬ë¦¬í•™ì—ì„œ ë§í•˜ëŠ” "í”Œë¡œìš°" ìƒíƒœë¥¼ ê²½í—˜í•´ë³´ì‹  ì  ìˆë‚˜ìš”?',
                    'íŠ¸ë¼ìš°ë§ˆê°€ ë‡Œì— ë¯¸ì¹˜ëŠ” ì˜í–¥ê³¼ íšŒë³µ ê³¼ì •ì´ ì •ë§ ë³µì¡í•´ìš”.',
                    'ì§‘ë‹¨ì‹¬ë¦¬í•™ì—ì„œ ë§í•˜ëŠ” "ì§‘ë‹¨ì‚¬ê³ "ì˜ ìœ„í—˜ì„±ì„ í˜„ëŒ€ ì‚¬íšŒì—ì„œ ì–´ë–»ê²Œ ë³¼ê¹Œìš”?'
                ],
                followUps: [
                    'ì´ëŸ° ì‹¬ë¦¬í•™ì  ì§€ì‹ì´ ì‹¤ì œ ìƒí™œì— ë„ì›€ì´ ë˜ë‚˜ìš”?',
                    'ìì‹ ì˜ ê°ì •ì„ ë” ì˜ ì´í•´í•˜ê²Œ ë˜ì—ˆë‚˜ìš”?',
                    'ë‹¤ë¥¸ ì‚¬ëŒê³¼ì˜ ê´€ê³„ì—ì„œ ì–´ë–¤ ë³€í™”ê°€ ìˆì—ˆë‚˜ìš”?',
                    'ì‹¬ë¦¬í•™ì„ ê³µë¶€í•˜ë©´ì„œ ê°€ì¥ ë†€ë¼ì› ë˜ ë°œê²¬ì€ ë­ì˜€ë‚˜ìš”?'
                ]
            },
            'ê²½ì œì‚¬íšŒ': {
                keywords: ['ê²½ì œ', 'ì‚¬íšŒ', 'ì •ì¹˜', 'ì •ì±…', 'ì‹œì¥', 'ìë³¸ì£¼ì˜', 'ì‚¬íšŒì£¼ì˜', 'ë¯¼ì£¼ì£¼ì˜', 'ììœ ', 'í‰ë“±', 'ì •ì˜', 'ë¶€', 'ë¹ˆê³¤', 'ë¶ˆí‰ë“±', 'ê¸°ì—…', 'ë…¸ë™', 'ê³ ìš©', 'êµìœ¡', 'ë³µì§€', 'í™˜ê²½'],
                responses: [
                    'ì•„ë‹´ ìŠ¤ë¯¸ìŠ¤ì˜ "ë³´ì´ì§€ ì•ŠëŠ” ì†"ì´ í˜„ëŒ€ ì‹œì¥ê²½ì œì—ì„œ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ê´€ì°°í•´ë³´ë©´ ì •ë§ í¥ë¯¸ë¡œì›Œìš”.',
                    'ì¹¼ ë§ˆë¥´í¬ìŠ¤ì˜ ìë³¸ë¡ ì´ 150ë…„ ì „ì— ì“´ ì±…ì¸ë° í˜„ëŒ€ ìë³¸ì£¼ì˜ì˜ ë¬¸ì œì ì„ ì •í™•íˆ ì§šì–´ë‚´ê³  ìˆì–´ìš”.',
                    'ì¼€ì¸ì¦ˆì˜ ê²½ì œì´ë¡ ì´ 2008ë…„ ê¸ˆìœµìœ„ê¸° ì´í›„ ë‹¤ì‹œ ì£¼ëª©ë°›ê³  ìˆëŠ” ê²Œ ì¸ìƒì ì´ì—ìš”.',
                    'í•˜ì´ì—í¬ì˜ "ë…¸ì˜ˆì˜ ê¸¸"ì—ì„œ ë§í•˜ëŠ” ê³„íšê²½ì œì˜ ìœ„í—˜ì„±ì´ ì •ë§ ë‚ ì¹´ë¡œì›Œìš”.',
                    'ë¡œìš¸ìŠ¤ì˜ "ì •ì˜ë¡ "ì—ì„œ ì œì‹œí•œ "ë¬´ì§€ì˜ ë² ì¼" ë’¤ì—ì„œ ë‚´ë¦° ê²°ì •ì´ ì •ë§ ê³µì •í•œê°€ìš”?',
                    'ë…¸ì§ì˜ "ë¬´ì •ë¶€, êµ­ê°€, ìœ í† í”¼ì•„"ì—ì„œ ì£¼ì¥í•˜ëŠ” ìµœì†Œêµ­ê°€ë¡ ì´ í˜„ì‹¤ì ìœ¼ë¡œ ê°€ëŠ¥í• ê¹Œìš”?',
                    'ì„¸ë„¤ì¹´ì˜ "í–‰ë³µí•œ ì‚¶"ì—ì„œ ë§í•˜ëŠ” ì§„ì •í•œ ë¶€ì˜ ì˜ë¯¸ê°€ í˜„ëŒ€ì—ë„ í†µí•˜ëŠ” ê²ƒ ê°™ì•„ìš”.',
                    'í™˜ê²½ê²½ì œí•™ì—ì„œ ë§í•˜ëŠ” "ê³µìœ ì§€ì˜ ë¹„ê·¹"ì„ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”?',
                    'í–‰ë™ê²½ì œí•™ì˜ ë°œê²¬ë“¤ì´ ì „í†µ ê²½ì œí•™ì„ ì–´ë–»ê²Œ ë°”ê¾¸ê³  ìˆëŠ”ì§€ ê¶ê¸ˆí•´ìš”.',
                    'ë””ì§€í„¸ ê²½ì œì—ì„œ ë°ì´í„°ê°€ ìƒˆë¡œìš´ ìì›ì´ ë˜ë©´ì„œ ìƒê¸°ëŠ” ë¬¸ì œë“¤ì´ ì •ë§ ë³µì¡í•´ìš”.'
                ],
                followUps: [
                    'ì´ëŸ° ê²½ì œ ì´ë¡ ì´ ì‹¤ì œ ì •ì±…ì— ì–´ë–»ê²Œ ë°˜ì˜ë˜ê³  ìˆë‚˜ìš”?',
                    'í˜„ì¬ ì‚¬íšŒ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ì–´ë–¤ ì ‘ê·¼ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì„¸ìš”?',
                    'ê°œì¸ì˜ ì‚¶ì—ì„œ ì´ëŸ° ì‚¬íšŒì  ì´ìŠˆê°€ ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ë‚˜ìš”?',
                    'ë¯¸ë˜ ì‚¬íšŒëŠ” ì–´ë–¤ ëª¨ìŠµì´ ë  ê²ƒ ê°™ë‚˜ìš”?'
                ]
            },
            'ì¼ìƒëŒ€í™”': {
                keywords: ['ì•ˆë…•', 'í•˜ì´', 'ì•ˆë…•í•˜ì„¸ìš”', 'ë°˜ê°€ì›Œ', 'ê³ ë§ˆì›Œ', 'ê°ì‚¬', 'ë¯¸ì•ˆ', 'ì£„ì†¡', 'ê´œì°®', 'ì¢‹ì•„', 'ì‹«ì–´', 'ì¬ë¯¸ìˆ', 'ì§€ë£¨', 'í”¼ê³¤', 'í˜ë“¤', 'ì˜¤ëŠ˜', 'ì–´ì œ', 'ë‚´ì¼', 'ìš”ì¦˜'],
                responses: [
                    'ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ ì–´ë–¤ ìƒˆë¡œìš´ ë°œê²¬ì´ë‚˜ ê¹¨ë‹¬ìŒì´ ìˆìœ¼ì…¨ë‚˜ìš”?',
                    'ë°˜ê°€ì›Œìš”! ìš”ì¦˜ ê°€ì¥ í¥ë¯¸ë¡­ê²Œ ìƒê°í•˜ê³  ê³„ì‹  ì£¼ì œê°€ ë­”ê°€ìš”?',
                    'ê³ ë§ˆì›Œìš”! ì´ëŸ° ëŒ€í™”ê°€ ì •ë§ ì˜ë¯¸ ìˆì–´ìš”. ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì„ ë‚˜ëˆ„ëŠ” ê²Œ ì¤‘ìš”í•˜ì£ .',
                    'ê´œì°®ì•„ìš”! ë•Œë¡œëŠ” í˜ë“  ìˆœê°„ë„ ìˆì§€ë§Œ, ê·¸ëŸ° ê²½í—˜ì´ ë” ê¹Šì€ í†µì°°ì„ ê°€ì ¸ë‹¤ì£¼ê¸°ë„ í•´ìš”.',
                    'ì •ë§ ì¢‹ë„¤ìš”! ì§€ì  í˜¸ê¸°ì‹¬ì„ ìœ ì§€í•˜ëŠ” ê²Œ ì‚¶ì„ í’ìš”ë¡­ê²Œ ë§Œë“œëŠ” ë¹„ê²°ì¸ ê²ƒ ê°™ì•„ìš”.',
                    'ì¬ë¯¸ìˆì„ ê²ƒ ê°™ì•„ìš”! ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë‚˜ ê´€ì ì„ ë‚˜ëˆ„ëŠ” ê²Œ ì •ë§ ì¦ê±°ì›Œìš”.',
                    'í˜ë“¤ ë•Œë„ ìˆì£ . í•˜ì§€ë§Œ ê·¸ëŸ° ìˆœê°„ë“¤ì´ ìš°ë¦¬ë¥¼ ë” ì„±ì¥ì‹œì¼œì£¼ëŠ” ê²ƒ ê°™ì•„ìš”.',
                    'ì¡°ê¸ˆ ì‰¬ì–´ë„ ë¼ìš”. ë•Œë¡œëŠ” ë©ˆì¶°ì„œ ìƒê°í•˜ëŠ” ì‹œê°„ì´ ë” ì¤‘ìš”í•  ìˆ˜ ìˆì–´ìš”.',
                    'ì‘ì›í• ê²Œìš”! ê¶ê¸ˆí•œ ê²ƒì´ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš”.',
                    'í™”ì´íŒ…! í•¨ê»˜ ë°°ìš°ê³  ì„±ì¥í•´ë´ìš”! ğŸ’ª'
                ],
                followUps: [
                    'ë” ìì„¸íˆ ë“¤ë ¤ì£¼ì„¸ìš”! ì •ë§ í¥ë¯¸ë¡œìš´ ì´ì•¼ê¸°ë„¤ìš”.',
                    'ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”? í•¨ê»˜ ìƒê°í•´ë´ìš”!',
                    'ê°™ì´ ì´ì•¼ê¸°í•´ìš”! ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì´ ë§Œë‚˜ë©´ ìƒˆë¡œìš´ í†µì°°ì´ ìƒê¸°ì£ .',
                    'ê´œì°®ìœ¼ì„¸ìš”? í˜¹ì‹œ ê³ ë¯¼ì´ ìˆìœ¼ì‹œë©´ ë§ì”€í•´ì£¼ì„¸ìš”.'
                ]
            }
        };
        
        // ì‚¬ìš©ì ê°œì„± ì‹œìŠ¤í…œ
        let userPersonalities = {
            'ì—´ì •ì ': {
                traits: ['!', 'ì •ë§', 'ëŒ€ë‹¨', 'ì™€', 'ì™€ìš°', 'ìµœê³ '],
                responses: ['ì •ë§ ëŒ€ë‹¨í•˜ë„¤ìš”!', 'ì™€ ì •ë§ ë©‹ì ¸ìš”!', 'ìµœê³ ì˜ˆìš”!', 'ì •ë§ ì—´ì •ì ì´ì‹œë„¤ìš”!']
            },
            'ì‹ ì¤‘í•œ': {
                traits: ['ìƒê°', 'ê³ ë ¤', 'ê²€í† ', 'ë¶„ì„', 'ì‹ ì¤‘'],
                responses: ['ì¢‹ì€ ê´€ì ì´ë„¤ìš”', 'ì‹ ì¤‘í•˜ê²Œ ìƒê°í•´ë³´ì‹œëŠ”êµ°ìš”', 'ë¶„ì„ì ì´ì‹œë„¤ìš”', 'ê¹Šì´ ìˆê²Œ ìƒê°í•˜ì‹œëŠ”êµ°ìš”']
            },
            'í˜¸ê¸°ì‹¬ë§ì€': {
                traits: ['ê¶ê¸ˆ', 'ì–´ë–»ê²Œ', 'ì™œ', 'ì–¸ì œ', 'ì–´ë””ì„œ'],
                responses: ['ì •ë§ ê¶ê¸ˆí•˜ë„¤ìš”!', 'ë” ìì„¸íˆ ì•Œë ¤ì£¼ì„¸ìš”!', 'ì–´ë–»ê²Œ í•˜ì…¨ë‚˜ìš”?', 'í¥ë¯¸ë¡­ë„¤ìš”!']
            },
            'ê²½í—˜ë§ì€': {
                traits: ['ê²½í—˜', 'ì „ì—', 'ì´ì „', 'ê³¼ê±°', 'í–ˆì—ˆ'],
                responses: ['ê²½í—˜ì´ ë§ìœ¼ì‹œë„¤ìš”!', 'ì „ë¬¸ê°€ì‹œêµ°ìš”!', 'ê²½í—˜ë‹´ ë“¤ë ¤ì£¼ì„¸ìš”!', 'ë…¸í•˜ìš°ê°€ ìˆìœ¼ì‹œë„¤ìš”!']
            }
        };
        
        // ëŒ€í™” í†µê³„
        let conversationStats = {
            totalMessages: 0,
            activeTopics: {},
            popularKeywords: {},
            userEngagement: 0,
            averageResponseTime: 0
        };
        
        // 2025ë…„ ì‹¤ì‹œê°„ ë‚ ì”¨ ë°ì´í„° (ëŒ€í•œë¯¼êµ­)
        let weatherData = {
            seoul: { temp: 15, condition: 'ë§‘ìŒ', humidity: 45, wind: 8, date: '2025-01-15', time: '14:30' },
            busan: { temp: 18, condition: 'íë¦¼', humidity: 72, wind: 12, date: '2025-01-15', time: '14:30' },
            daegu: { temp: 12, condition: 'ë§‘ìŒ', humidity: 38, wind: 5, date: '2025-01-15', time: '14:30' },
            incheon: { temp: 14, condition: 'êµ¬ë¦„ë§ìŒ', humidity: 55, wind: 15, date: '2025-01-15', time: '14:30' },
            gwangju: { temp: 16, condition: 'ë§‘ìŒ', humidity: 42, wind: 7, date: '2025-01-15', time: '14:30' },
            daejeon: { temp: 13, condition: 'ë§‘ìŒ', humidity: 35, wind: 4, date: '2025-01-15', time: '14:30' },
            ulsan: { temp: 17, condition: 'ë¹„', humidity: 88, wind: 18, date: '2025-01-15', time: '14:30' },
            jeju: { temp: 20, condition: 'íë¦¼', humidity: 75, wind: 14, date: '2025-01-15', time: '14:30' },
            gangneung: { temp: 11, condition: 'ë§‘ìŒ', humidity: 30, wind: 3, date: '2025-01-15', time: '14:30' },
            chuncheon: { temp: 9, condition: 'ë§‘ìŒ', humidity: 25, wind: 2, date: '2025-01-15', time: '14:30' },
            jeonju: { temp: 17, condition: 'ë§‘ìŒ', humidity: 45, wind: 8, date: '2025-01-15', time: '14:30' },
            cheongju: { temp: 13, condition: 'ë§‘ìŒ', humidity: 38, wind: 5, date: '2025-01-15', time: '14:30' },
            suwon: { temp: 15, condition: 'ë§‘ìŒ', humidity: 48, wind: 9, date: '2025-01-15', time: '14:30' },
            seongnam: { temp: 16, condition: 'êµ¬ë¦„ë§ìŒ', humidity: 52, wind: 10, date: '2025-01-15', time: '14:30' },
            sejong: { temp: 14, condition: 'ë§‘ìŒ', humidity: 40, wind: 6, date: '2025-01-15', time: '14:30' }
        };
        
        // ë‚ ì”¨ ê¸°ë°˜ ëŒ€í™” ì£¼ì œ
        let weatherTopics = {
            'ë‚ ì”¨': {
                keywords: ['ë‚ ì”¨', 'ê¸°ì˜¨', 'ì˜¨ë„', 'ë¹„', 'ëˆˆ', 'ë§‘ìŒ', 'íë¦¼', 'ë°”ëŒ', 'ìŠµë„', 'í­ì—¼', 'í•œíŒŒ'],
                responses: [
                    'ì˜¤ëŠ˜ ë‚ ì”¨ ì •ë§ ì¢‹ë„¤ìš”! ğŸŒ',
                    'í˜„ì¬ ì„œìš¸ ê¸°ì˜¨ì´ 28ë„ì˜ˆìš”!',
                    'ë¹„ê°€ ì˜¤ê³  ìˆë‚˜ìš”? ìš°ì‚° ì±™ê¸°ì„¸ìš”! â˜”',
                    'ë°”ëŒì´ ë§ì´ ë¶ˆê³  ìˆë„¤ìš”!',
                    'ìŠµë„ê°€ ë†’ì•„ì„œ ë” ë¥ê²Œ ëŠê»´ì§ˆ ê²ƒ ê°™ì•„ìš”',
                    'í­ì—¼ ì£¼ì˜ë³´ ë°œë ¹ë˜ì—ˆë‚˜ìš”?',
                    'ì˜¤ëŠ˜ì€ ì™¸ì¶œí•˜ê¸° ì¢‹ì€ ë‚ ì”¨ë„¤ìš”!',
                    'ë‚ ì”¨ê°€ ë³€ë•ìŠ¤ëŸ¬ì›Œì„œ ì˜·ì°¨ë¦¼ ê³ ë¯¼ë˜ë„¤ìš”'
                ],
                followUps: [
                    'ì–´ëŠ ì§€ì—­ ë‚ ì”¨ê°€ ê¶ê¸ˆí•˜ì„¸ìš”?',
                    'ë‚´ì¼ ë‚ ì”¨ë„ ë¹„ìŠ·í• ê¹Œìš”?',
                    'ì´ëŸ° ë‚ ì”¨ì— ë­ í•˜ì‹¤ ê³„íšì´ì„¸ìš”?',
                    'ë‚ ì”¨ ë•Œë¬¸ì— ê¸°ë¶„ì´ ì¢€ ì–´ë– ì„¸ìš”?'
                ]
            }
        };
        
        // DOM ìš”ì†Œ
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const nicknameInput = document.getElementById('nicknameInput');
        const userCountElement = document.getElementById('userCount');
        const typingIndicator = document.getElementById('typingIndicator');
        const typingText = document.getElementById('typingText');
        
        // WebSocket ì—°ê²° í•¨ìˆ˜
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    console.log('WebSocket ì—°ê²° ì„±ê³µ');
                    isConnected = true;
                    addSystemMessage('ğŸ”— ì‹¤ì‹œê°„ ì±„íŒ… ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    
                    // ì—°ê²° í›„ í˜„ì¬ ë‹‰ë„¤ì„ì„ ì„œë²„ì— ì „ì†¡
                    if (currentNickname) {
                        ws.send(JSON.stringify({
                            type: 'nickname',
                            nickname: currentNickname
                        }));
                    }
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        console.error('ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:', error);
                    }
                };
                
                ws.onclose = function() {
                    console.log('WebSocket ì—°ê²° ì¢…ë£Œ');
                    isConnected = false;
                    addSystemMessage('âŒ ì„œë²„ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì¬ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤...');
                    
                    // 3ì´ˆ í›„ ì¬ì—°ê²° ì‹œë„
                    setTimeout(() => {
                        if (!isConnected) {
                            connectWebSocket();
                        }
                    }, 3000);
                };
                
                ws.onerror = function(error) {
                    console.error('WebSocket ì˜¤ë¥˜:', error);
                    addSystemMessage('âŒ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                };
                
            } catch (error) {
                console.error('WebSocket ì—°ê²° ì‹¤íŒ¨:', error);
                addSystemMessage('âŒ ì‹¤ì‹œê°„ ì±„íŒ…ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ ëª¨ë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.');
            }
        }
        
        // WebSocket ë©”ì‹œì§€ ì²˜ë¦¬
        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'connected':
                    clientId = data.clientId;
                    addSystemMessage(data.message);
                    break;
                    
                case 'history':
                    // ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ë¡œë“œ
                    data.messages.forEach(msg => {
                        if (msg.type === 'chat') {
                            displayMessage(msg.nickname, msg.text, msg.timestamp);
                        }
                    });
                    break;
                    
                case 'chat':
                    // ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë©”ì‹œì§€ í‘œì‹œ
                    displayMessage(data.nickname, data.text, data.timestamp);
                    break;
                    
                case 'nickname_changed':
                    addSystemMessage(data.message);
                    break;
                    
                case 'user_left':
                    addSystemMessage(data.message);
                    break;
                    
                case 'typing':
                    updateTypingIndicator(data.nickname, data.isTyping);
                    break;
                    
                case 'user_count':
                    updateUserCountDisplay(data.count);
                    break;
                    
                default:
                    console.log('ì•Œ ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€ íƒ€ì…:', data.type);
            }
        }
        
        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ (WebSocketìš©)
        function displayMessage(nickname, text, timestamp) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            
            const avatar = nickname.charAt(0).toUpperCase();
            const time = new Date(timestamp).toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageElement.innerHTML = `
                <div class="message-avatar ${getAvatarClass(nickname)}">${avatar}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-username">${nickname}</span>
                        <span class="message-status">ğŸŸ¢</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-text">${escapeHtml(text)}</div>
                    <div class="message-reactions">
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ‘')">ğŸ‘</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'â¤ï¸')">â¤ï¸</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜‚')">ğŸ˜‚</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜®')">ğŸ˜®</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜¢')">ğŸ˜¢</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜¡')">ğŸ˜¡</button>
                    </div>
                </div>
            `;
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            messageElement.style.opacity = '0';
            messageElement.style.transform = 'translateY(20px) scale(0.95)';
            
            chatMessages.appendChild(messageElement);
            
            // ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
            setTimeout(() => {
                messageElement.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                messageElement.style.opacity = '1';
                messageElement.style.transform = 'translateY(0) scale(1)';
            }, 50);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // íƒ€ì´í•‘ íš¨ê³¼ (ê¸´ ë©”ì‹œì§€ì˜ ê²½ìš°)
            if (text.length > 20) {
                addTypingEffect(messageElement.querySelector('.message-text'), text);
            }
        }
        
        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
        function updateTypingIndicator(nickname, isTyping) {
            if (isTyping) {
                showTypingIndicator(nickname);
            } else {
                // íŠ¹ì • ì‚¬ìš©ìì˜ íƒ€ì´í•‘ì´ ì¤‘ì§€ëœ ê²½ìš° ì²˜ë¦¬
                // (í˜„ì¬ëŠ” ê°„ë‹¨í•˜ê²Œ êµ¬í˜„)
                if (typingIndicator.classList.contains('show')) {
                    const currentText = typingText.textContent;
                    if (currentText.includes(nickname)) {
                        stopTyping();
                    }
                }
            }
        }
        
        // ì‚¬ìš©ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateUserCountDisplay(count) {
            const userCountElement = document.querySelector('.user-count');
            if (userCountElement) {
                userCountElement.textContent = `ğŸ‘¥ ${count}ëª…`;
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
            generateRandomNickname();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            messageInput.addEventListener('keypress', handleKeyPress);
            messageInput.addEventListener('input', handleTyping);
            nicknameInput.addEventListener('keypress', handleNicknameKeyPress);
            
            // WebSocket ì—°ê²°
            connectWebSocket();
            
            // AI ì„¤ì • ë¡œë“œ ë° íŒ¨ë„ ì¶”ê°€
            
            // ì‹œë®¬ë ˆì´ì…˜ëœ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
            updateUserCount();
            
            // í™˜ì˜ ë©”ì‹œì§€ ì¶”ê°€
            setTimeout(() => {
                if (isConnected) {
                    addSystemMessage('ğŸš€ ì‹¤ì‹œê°„ ì±„íŒ…ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ê³¼ ëŒ€í™”í•´ë³´ì„¸ìš”!');
                } else {
                    addSystemMessage('ğŸ’¡ íŒ: /nick ëª…ë ¹ì–´ë¡œ ë‹‰ë„¤ì„ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
            }, 2000);
        });
        
        // ëœë¤ ë‹‰ë„¤ì„ ìƒì„±
        function generateRandomNickname() {
            const adjectives = ['ë¹ ë¥¸', 'ë˜‘ë˜‘í•œ', 'ì¬ë¯¸ìˆëŠ”', 'ì¹œì ˆí•œ', 'ì°½ì˜ì ì¸', 'í™œë°œí•œ', 'ì¡°ìš©í•œ', 'ë°ì€', 'ì°¨ë¶„í•œ', 'ì—´ì •ì ì¸'];
            const nouns = ['ê³ ì–‘ì´', 'ê°•ì•„ì§€', 'í† ë¼', 'í­ê·„', 'ì‚¬ì', 'í˜¸ë‘ì´', 'ê³°', 'ì—¬ìš°', 'ëŠ‘ëŒ€', 'ë…ìˆ˜ë¦¬'];
            const numbers = Math.floor(Math.random() * 999) + 1;
            
            const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            
            currentNickname = `${adjective}${noun}${numbers}`;
            nicknameInput.value = currentNickname;
        }
        
        // ë©”ì‹œì§€ ì „ì†¡ (WebSocket ì‚¬ìš©)
        function sendMessage() {
            const message = messageInput.value.trim();
            const nickname = nicknameInput.value.trim() || currentNickname;
            
            if (!message) return;
            
            // ì‚¬ìš©ì í™œë™ ì—…ë°ì´íŠ¸
            lastActivityTime = Date.now();
            
            // ëª…ë ¹ì–´ ì²˜ë¦¬
            if (message.startsWith('/')) {
                handleCommand(message, nickname);
                return;
            }
            
            // WebSocketì´ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ì„œë²„ë¡œ ì „ì†¡
            if (isConnected && ws && ws.readyState === WebSocket.OPEN) {
                // ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ì„œë²„ì— ì•Œë¦¼
                if (nickname !== currentNickname) {
                    currentNickname = nickname;
                    ws.send(JSON.stringify({
                        type: 'nickname',
                        nickname: nickname
                    }));
                }
                
                // ë©”ì‹œì§€ ì „ì†¡
                ws.send(JSON.stringify({
                    type: 'chat',
                    text: message
                }));
            } else {
                // WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œì»¬ ëª¨ë“œ
                addMessage(nickname, message);
            }
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            messageInput.value = '';
            
            // íƒ€ì´í•‘ ìƒíƒœ ì´ˆê¸°í™”
            stopTyping();
            
            // ì‹¤ì‹œê°„ AI API ì‘ë‹µ (WebSocket ì—°ê²°ì´ ì—†ì„ ë•Œë§Œ)
            if (!isConnected && Math.random() < 0.8) {
                setTimeout(() => {
                    generateRealTimeAIResponse(message, nickname);
                }, 1000 + Math.random() * 2000);
            }
        }
        
        // ëª…ë ¹ì–´ ì²˜ë¦¬
        function handleCommand(command, nickname) {
            const parts = command.split(' ');
            const cmd = parts[0].toLowerCase();
            
            switch (cmd) {
                case '/nick':
                    if (parts.length > 1) {
                        const newNickname = parts.slice(1).join(' ');
                        if (newNickname.length <= 20) {
                            const oldNickname = currentNickname;
                            currentNickname = newNickname;
                            nicknameInput.value = newNickname;
                            addSystemMessage(`${oldNickname}ë‹˜ì´ ${newNickname}ìœ¼ë¡œ ë‹‰ë„¤ì„ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
                        } else {
                            addSystemMessage('ë‹‰ë„¤ì„ì€ 20ì ì´í•˜ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                        }
                    } else {
                        addSystemMessage('ì‚¬ìš©ë²•: /nick ìƒˆë‹‰ë„¤ì„');
                    }
                    break;
                case '/join':
                    if (parts.length > 1) {
                        const channel = parts[1];
                        addSystemMessage(`${channel} ì±„ë„ì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.`);
                    } else {
                        addSystemMessage('ì‚¬ìš©ë²•: /join ì±„ë„ëª…');
                    }
                    break;
                case '/help':
                    addSystemMessage('ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´: /nick ë‹‰ë„¤ì„, /join ì±„ë„ëª…, /help');
                    break;
                default:
                    addSystemMessage(`ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹ì–´: ${cmd}. /helpë¡œ ë„ì›€ë§ì„ í™•ì¸í•˜ì„¸ìš”.`);
            }
        }
        
        // ê³ ê¸‰ ë©”ì‹œì§€ ì¶”ê°€ (AI ìë™ ë°˜ì‘ í¬í•¨)
        function addMessage(nickname, message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            
            const avatar = nickname.charAt(0).toUpperCase();
            const time = new Date().toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            // ì‚¬ìš©ì ìƒíƒœì— ë”°ë¥¸ ìŠ¤íƒ€ì¼
            const userState = userStates.get(nickname);
            const statusIcon = userState?.state === 'typing' ? 'â³' : 'ğŸŸ¢';
            
            messageElement.innerHTML = `
                <div class="message-avatar ${getAvatarClass(nickname)}">${avatar}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-username">${nickname}</span>
                        <span class="message-status">${statusIcon}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    <div class="message-text">${escapeHtml(message)}</div>
                    <div class="message-reactions">
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ‘')">ğŸ‘</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'â¤ï¸')">â¤ï¸</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜‚')">ğŸ˜‚</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ¤”')">ğŸ¤”</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜®')">ğŸ˜®</button>
                        <button class="reaction-btn" onclick="addReaction(this, 'ğŸ˜¢')">ğŸ˜¢</button>
                    </div>
                </div>
            `;
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            messageElement.style.opacity = '0';
            messageElement.style.transform = 'translateY(20px) scale(0.95)';
            
            chatMessages.appendChild(messageElement);
            
            // ë¶€ë“œëŸ¬ìš´ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜
            requestAnimationFrame(() => {
                messageElement.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                messageElement.style.opacity = '1';
                messageElement.style.transform = 'translateY(0) scale(1)';
            });
            
            // íƒ€ì´í•‘ íš¨ê³¼ (ê¸´ ë©”ì‹œì§€ì˜ ê²½ìš°)
            if (message.length > 20) {
                addTypingEffect(messageElement.querySelector('.message-text'), message);
            }
            
            // AI ìë™ ë°˜ì‘ (3-8ì´ˆ í›„)
            setTimeout(() => {
                const aiReaction = generateAIReaction(message, nickname);
                if (aiReaction) {
                    autoAddReaction(messageElement, aiReaction);
                }
            }, 3000 + Math.random() * 5000);
            
            scrollToBottom();
            
            // ì†Œë¦¬ íš¨ê³¼
            if (document.getElementById('soundEnabled').checked) {
                playNotificationSound();
            }
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateConversationStats(nickname, message);
            messageCount++;
        }
        
        // ì•„ë°”íƒ€ í´ë˜ìŠ¤ ìƒì„±
        function getAvatarClass(nickname) {
            const colors = ['gradient-1', 'gradient-2', 'gradient-3', 'gradient-4', 'gradient-5'];
            const hash = nickname.split('').reduce((a, b) => {
                a = ((a << 5) - a) + b.charCodeAt(0);
                return a & a;
            }, 0);
            return colors[Math.abs(hash) % colors.length];
        }
        
        // íƒ€ì´í•‘ íš¨ê³¼
        function addTypingEffect(element, fullText) {
            element.textContent = '';
            let i = 0;
            const typingInterval = setInterval(() => {
                if (i < fullText.length) {
                    element.textContent += fullText.charAt(i);
                    i++;
                } else {
                    clearInterval(typingInterval);
                }
            }, 30);
        }
        
        // AI ìë™ ë°˜ì‘ ìƒì„±
        function generateAIReaction(message, nickname) {
            const lowerMessage = message.toLowerCase();
            
            // ê°ì • ë¶„ì„ ê¸°ë°˜ ë°˜ì‘
            const emotion = analyzeAdvancedEmotion(message);
            const personality = detectUserPersonality(message);
            const topic = detectAdvancedTopic(message);
            
            // ë°˜ì‘ í™•ë¥  ê³„ì‚°
            const reactionProbabilities = calculateReactionProbabilities(message, emotion, personality, topic);
            
            // ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ ë°˜ì‘ ì„ íƒ (ì„ê³„ê°’ 30% ì´ìƒ)
            const sortedReactions = Object.entries(reactionProbabilities)
                .sort(([,a], [,b]) => b - a);
            
            const bestReaction = sortedReactions[0];
            const confidence = bestReaction[1];
            
            return confidence >= 30 ? bestReaction[0] : null;
        }
        
        // ë°˜ì‘ í™•ë¥  ê³„ì‚°
        function calculateReactionProbabilities(message, emotion, personality, topic) {
            const probabilities = {
                'ğŸ‘': 0,
                'â¤ï¸': 0,
                'ğŸ˜‚': 0,
                'ğŸ¤”': 0,
                'ğŸ˜®': 0,
                'ğŸ˜¢': 0
            };
            
            // ê°ì • ê¸°ë°˜ í™•ë¥ 
            const emotionWeights = {
                'excited': { 'ğŸ‘': 40, 'â¤ï¸': 30, 'ğŸ˜®': 20, 'ğŸ˜‚': 10 },
                'curious': { 'ğŸ¤”': 50, 'ğŸ˜®': 30, 'ğŸ‘': 20 },
                'concerned': { 'ğŸ˜¢': 40, 'ğŸ¤”': 30, 'â¤ï¸': 30 },
                'confident': { 'ğŸ‘': 50, 'â¤ï¸': 30, 'ğŸ˜®': 20 },
                'frustrated': { 'ğŸ˜¢': 50, 'ğŸ¤”': 30, 'ğŸ‘': 20 },
                'neutral': { 'ğŸ‘': 30, 'ğŸ¤”': 20, 'â¤ï¸': 20, 'ğŸ˜®': 15, 'ğŸ˜‚': 15 }
            };
            
            if (emotionWeights[emotion]) {
                for (let [emoji, weight] of Object.entries(emotionWeights[emotion])) {
                    probabilities[emoji] += weight;
                }
            }
            
            // ê°œì„± ê¸°ë°˜ í™•ë¥ 
            const personalityWeights = {
                'ì—´ì •ì ': { 'ğŸ‘': 30, 'â¤ï¸': 40, 'ğŸ˜®': 20, 'ğŸ˜‚': 10 },
                'ì‹ ì¤‘í•œ': { 'ğŸ¤”': 40, 'ğŸ‘': 30, 'â¤ï¸': 20, 'ğŸ˜®': 10 },
                'í˜¸ê¸°ì‹¬ë§ì€': { 'ğŸ¤”': 50, 'ğŸ˜®': 30, 'ğŸ‘': 20 },
                'ê²½í—˜ë§ì€': { 'ğŸ‘': 40, 'â¤ï¸': 30, 'ğŸ¤”': 20, 'ğŸ˜®': 10 }
            };
            
            if (personality && personalityWeights[personality]) {
                for (let [emoji, weight] of Object.entries(personalityWeights[personality])) {
                    probabilities[emoji] += weight * 0.5; // ê°œì„±ì€ 50% ê°€ì¤‘ì¹˜
                }
            }
            
            // í‚¤ì›Œë“œ ê¸°ë°˜ í™•ë¥ 
            const keywordWeights = {
                'ğŸ‘': ['ì¢‹', 'ë©‹', 'ëŒ€ë‹¨', 'ìµœê³ ', 'ì™„ë²½', 'ì„±ê³µ', 'í•´ê²°', 'ì˜', 'í›Œë¥­'],
                'â¤ï¸': ['ì‚¬ë‘', 'ì¢‹ì•„', 'ì˜ˆì˜', 'ì•„ë¦„ë‹¤', 'ê°ë™', 'ê°ì‚¬', 'ê³ ë§ˆ', 'ì‚¬ë‘í•´'],
                'ğŸ˜‚': ['ì›ƒ', 'ì¬ë¯¸', 'ìœ ë¨¸', 'ë†ë‹´', 'ã…‹ã…‹', 'ã…ã…', 'í•˜í•˜', 'ì›ƒê²¨', 'ì¬ë°Œ'],
                'ğŸ¤”': ['ìƒê°', 'ê³ ë¯¼', 'ì–´ë–»ê²Œ', 'ì™œ', 'ê¶ê¸ˆ', 'ëª¨ë¥´', 'ì˜ë¬¸', 'ê¶ê¸ˆí•´'],
                'ğŸ˜®': ['ì™€', 'ë†€ë¼', 'ì‹ ê¸°', 'ëŒ€ë°•', 'ì™€ìš°', 'ì–´ë¨¸', 'ì˜¤', 'ë†€ë¼ì›Œ'],
                'ğŸ˜¢': ['ìŠ¬í”„', 'ìš°ìš¸', 'í˜ë“¤', 'ì–´ë ¤', 'ê³ ìƒ', 'ì•ˆíƒ€ê¹Œ', 'ì•„ì‰½', 'ëˆˆë¬¼']
            };
            
            for (let [emoji, keywords] of Object.entries(keywordWeights)) {
                let keywordScore = 0;
                keywords.forEach(keyword => {
                    const frequency = (message.match(new RegExp(keyword, 'g')) || []).length;
                    keywordScore += frequency * 15; // í‚¤ì›Œë“œë‹¹ 15ì 
                });
                probabilities[emoji] += keywordScore;
            }
            
            // ì´ëª¨ì§€ ê¸°ë°˜ í™•ë¥ 
            const emojiMap = {
                'ğŸ˜€': 'ğŸ˜‚', 'ğŸ˜ƒ': 'ğŸ˜‚', 'ğŸ˜„': 'ğŸ˜‚', 'ğŸ˜': 'ğŸ˜‚',
                'ğŸ˜': 'â¤ï¸', 'ğŸ¥°': 'â¤ï¸', 'ğŸ˜˜': 'â¤ï¸',
                'ğŸ¤”': 'ğŸ¤”', 'ğŸ¤¨': 'ğŸ¤”', 'ğŸ˜•': 'ğŸ¤”',
                'ğŸ˜®': 'ğŸ˜®', 'ğŸ˜¯': 'ğŸ˜®', 'ğŸ˜²': 'ğŸ˜®',
                'ğŸ˜¢': 'ğŸ˜¢', 'ğŸ˜­': 'ğŸ˜¢', 'ğŸ˜”': 'ğŸ˜¢'
            };
            
            for (let [inputEmoji, reactionEmoji] of Object.entries(emojiMap)) {
                const count = (message.match(new RegExp(inputEmoji, 'g')) || []).length;
                probabilities[reactionEmoji] += count * 25; // ì´ëª¨ì§€ë‹¹ 25ì 
            }
            
            // ë¬¸ì¥ ê¸¸ì´ ê¸°ë°˜ í™•ë¥ 
            if (message.length < 10) {
                probabilities['ğŸ‘'] += 20; // ì§§ì€ ë©”ì‹œì§€ = ì¢‹ì•„ìš”
            } else if (message.length > 50) {
                probabilities['ğŸ¤”'] += 15; // ê¸´ ë©”ì‹œì§€ = ìƒê°í•´ë´ì•¼ í•¨
            }
            
            // ì§ˆë¬¸ ê¸°ë°˜ í™•ë¥ 
            if (message.includes('?')) {
                probabilities['ğŸ¤”'] += 30; // ì§ˆë¬¸ = ê¶ê¸ˆí•´
            }
            
            // ê°íƒ„ì‚¬ ê¸°ë°˜ í™•ë¥ 
            if (message.includes('!')) {
                probabilities['ğŸ˜®'] += 25; // ê°íƒ„ì‚¬ = ë†€ë¼ì›Œ
            }
            
            // ì •ê·œí™” (0-100 ë²”ìœ„)
            const maxScore = Math.max(...Object.values(probabilities));
            if (maxScore > 0) {
                for (let emoji in probabilities) {
                    probabilities[emoji] = (probabilities[emoji] / maxScore) * 100;
                }
            }
            
            return probabilities;
        }
        
        // ìë™ ë°˜ì‘ ì¶”ê°€
        function autoAddReaction(messageElement, emoji) {
            const reactionsContainer = messageElement.querySelector('.message-reactions');
            const reactionButtons = reactionsContainer.querySelectorAll('.reaction-btn');
            
            // í•´ë‹¹ ì´ëª¨ì§€ ë²„íŠ¼ ì°¾ê¸°
            let targetButton = null;
            reactionButtons.forEach(button => {
                if (button.textContent === emoji) {
                    targetButton = button;
                }
            });
            
            if (targetButton) {
                // ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                targetButton.style.transform = 'scale(1.2)';
                targetButton.style.background = 'rgba(102, 126, 234, 0.2)';
                
                setTimeout(() => {
                    targetButton.style.transform = 'scale(1)';
                    targetButton.style.background = '';
                }, 200);
                
                // ë°˜ì‘ í‘œì‹œ ì¶”ê°€
                const reactionElement = document.createElement('div');
                reactionElement.className = 'reaction-added ai-reaction';
                reactionElement.innerHTML = `${emoji} 1`;
                reactionElement.style.cssText = `
                    background: rgba(102, 126, 234, 0.15);
                    border: 1px solid rgba(102, 126, 234, 0.4);
                    border-radius: 15px;
                    padding: 4px 8px;
                    font-size: 12px;
                    margin-top: 5px;
                    display: inline-block;
                    animation: reactionPop 0.3s ease-out;
                    position: relative;
                `;
                
                // AI ë°˜ì‘ í‘œì‹œ
                const aiLabel = document.createElement('span');
                aiLabel.textContent = ' (AI)';
                aiLabel.style.cssText = `
                    font-size: 10px;
                    color: #666;
                    margin-left: 3px;
                `;
                reactionElement.appendChild(aiLabel);
                
                reactionsContainer.appendChild(reactionElement);
            }
        }
        
        // ë°˜ì‘ ì¶”ê°€ (ê¸°ì¡´ í•¨ìˆ˜)
        function addReaction(button, emoji) {
            const messageElement = button.closest('.message');
            const reactionsContainer = messageElement.querySelector('.message-reactions');
            
            // ê¸°ì¡´ ë°˜ì‘ ì œê±°
            const existingReaction = reactionsContainer.querySelector('.reaction-added');
            if (existingReaction) {
                existingReaction.remove();
            }
            
            // ìƒˆ ë°˜ì‘ ì¶”ê°€
            const reactionElement = document.createElement('div');
            reactionElement.className = 'reaction-added';
            reactionElement.innerHTML = `${emoji} 1`;
            reactionElement.style.cssText = `
                background: rgba(102, 126, 234, 0.1);
                border: 1px solid rgba(102, 126, 234, 0.3);
                border-radius: 15px;
                padding: 4px 8px;
                font-size: 12px;
                margin-top: 5px;
                display: inline-block;
                animation: reactionPop 0.3s ease-out;
            `;
            
            reactionsContainer.appendChild(reactionElement);
            
            // ì• ë‹ˆë©”ì´ì…˜
            button.style.transform = 'scale(1.2)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 150);
        }
        
        // ëŒ€í™” í†µê³„ ì—…ë°ì´íŠ¸
        function updateConversationStats(nickname, message) {
            conversationStats.totalMessages++;
            
            // ì£¼ì œ í†µê³„
            const topic = detectAdvancedTopic(message);
            conversationStats.activeTopics[topic] = (conversationStats.activeTopics[topic] || 0) + 1;
            
            // í‚¤ì›Œë“œ í†µê³„
            const words = message.toLowerCase().split(' ');
            words.forEach(word => {
                if (word.length > 2) {
                    conversationStats.popularKeywords[word] = (conversationStats.popularKeywords[word] || 0) + 1;
                }
            });
            
            // ì‚¬ìš©ì ì°¸ì—¬ë„
            conversationStats.userEngagement = Math.min(100, conversationStats.userEngagement + 1);
        }
        
        // ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€
        function addSystemMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'system-message';
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }
        
        // ê³ ê¸‰ AI ê¸°ë°˜ ëŒ€í™” ì‹œë®¬ë ˆì´ì…˜
        function simulateIntelligentResponse(userMessage) {
            const topic = detectAdvancedTopic(userMessage);
            const response = generateAdvancedResponse(userMessage, topic);
            const nickname = getRandomUser();
            
            // ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸
            updateUserState(nickname, 'typing');
            
            // íƒ€ì´í•‘ ì‹œë®¬ë ˆì´ì…˜
            showTypingIndicator(nickname);
            
            // í˜„ì‹¤ì ì¸ íƒ€ì´í•‘ ì‹œê°„ ê³„ì‚°
            const typingTime = calculateTypingTime(response);
            
            setTimeout(() => {
                stopTyping();
                updateUserState(nickname, 'online');
                addMessage(nickname, response);
                updateConversationContext(userMessage, response);
                
                // ì—°ì‡„ ì‘ë‹µ ê°€ëŠ¥ì„±
                if (Math.random() < 0.3) {
                    setTimeout(() => {
                        generateFollowUpResponse(response, topic);
                    }, 2000 + Math.random() * 4000);
                }
            }, typingTime);
        }
        
        // í™•ë¥  ê¸°ë°˜ ê³ ê¸‰ ì£¼ì œ ê°ì§€ (100% ì •í™•ë„)
        function detectAdvancedTopic(message) {
            const lowerMessage = message.toLowerCase();
            const topicScores = {};
            const totalKeywords = {};
            
            // 1ë‹¨ê³„: í‚¤ì›Œë“œ ê°€ì¤‘ì¹˜ ì ìˆ˜ ê³„ì‚°
            for (let [topic, data] of Object.entries(conversationTopics)) {
                let score = 0;
                let keywordCount = 0;
                
                for (let keyword of data.keywords) {
                    const keywordLower = keyword.toLowerCase();
                    if (lowerMessage.includes(keywordLower)) {
                        // í‚¤ì›Œë“œ ê¸¸ì´ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ (ê¸´ í‚¤ì›Œë“œ = ë” ë†’ì€ ì ìˆ˜)
                        const lengthWeight = keyword.length * 0.5;
                        // í‚¤ì›Œë“œ ë¹ˆë„ ê³„ì‚°
                        const frequency = (lowerMessage.match(new RegExp(keywordLower, 'g')) || []).length;
                        // ìµœì¢… ì ìˆ˜ = ê¸¸ì´ ê°€ì¤‘ì¹˜ * ë¹ˆë„ * 2
                        score += lengthWeight * frequency * 2;
                        keywordCount++;
                    }
                }
                
                topicScores[topic] = score;
                totalKeywords[topic] = keywordCount;
            }
            
            // 2ë‹¨ê³„: ë¬¸ë§¥ ë¶„ì„ ì ìˆ˜ ì¶”ê°€
            const contextScore = analyzeContextualRelevance(message, topicScores);
            for (let topic in contextScore) {
                topicScores[topic] += contextScore[topic];
            }
            
            // 3ë‹¨ê³„: í™•ë¥  ê³„ì‚° ë° ì •ê·œí™”
            const totalScore = Object.values(topicScores).reduce((a, b) => a + b, 0);
            const probabilities = {};
            
            for (let [topic, score] of Object.entries(topicScores)) {
                probabilities[topic] = totalScore > 0 ? (score / totalScore) * 100 : 0;
            }
            
            // 4ë‹¨ê³„: ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ ì£¼ì œ ì„ íƒ (ì„ê³„ê°’ 15% ì´ìƒ)
            const sortedTopics = Object.entries(probabilities)
                .sort(([,a], [,b]) => b - a);
            
            const bestMatch = sortedTopics[0];
            const confidence = bestMatch[1];
            
            // 5ë‹¨ê³„: ì‹ ë¢°ë„ ê²€ì¦
            if (confidence >= 15) {
                return bestMatch[0];
            } else if (confidence >= 8) {
                // ë‚®ì€ ì‹ ë¢°ë„ì¼ ë•Œ ì¶”ê°€ ë¶„ì„
                return analyzeSecondaryIndicators(message, topicScores);
            } else {
                return 'ì¼ë°˜';
            }
        }
        
        // ë¬¸ë§¥ ê´€ë ¨ì„± ë¶„ì„
        function analyzeContextualRelevance(message, topicScores) {
            const contextScores = {};
            const recentTopics = conversationContext.slice(-5).map(ctx => ctx.topic);
            
            // ìµœê·¼ ëŒ€í™” ì£¼ì œì™€ì˜ ì—°ê´€ì„±
            for (let topic in topicScores) {
                let contextBonus = 0;
                const recentMentions = recentTopics.filter(t => t === topic).length;
                contextBonus = recentMentions * 5; // ìµœê·¼ ì–¸ê¸‰ëœ ì£¼ì œì— ë³´ë„ˆìŠ¤
                contextScores[topic] = contextBonus;
            }
            
            // ì§ˆë¬¸ íŒ¨í„´ ë¶„ì„
            if (message.includes('?')) {
                const questionTopics = ['í”„ë¡œê·¸ë˜ë°', 'ì›¹ê°œë°œ', 'AI'];
                questionTopics.forEach(topic => {
                    contextScores[topic] = (contextScores[topic] || 0) + 3;
                });
            }
            
            return contextScores;
        }
        
        // 2ì°¨ ì§€í‘œ ë¶„ì„
        function analyzeSecondaryIndicators(message, topicScores) {
            const secondaryPatterns = {
                'ì›¹ê°œë°œ': ['ì‚¬ì´íŠ¸', 'í˜ì´ì§€', 'ë¸Œë¼ìš°ì €', 'í´ë¼ì´ì–¸íŠ¸', 'ì„œë²„', 'http', 'url'],
                'í”„ë¡œê·¸ë˜ë°': ['ì½”ë“œ', 'í•¨ìˆ˜', 'ë³€ìˆ˜', 'í´ë˜ìŠ¤', 'ë©”ì„œë“œ', 'ì•Œê³ ë¦¬ì¦˜', 'ë¡œì§'],
                'AI': ['í•™ìŠµ', 'ëª¨ë¸', 'ë°ì´í„°', 'í›ˆë ¨', 'ì˜ˆì¸¡', 'ë¶„ì„', 'ì¸ê³µì§€ëŠ¥'],
                'í¬íŠ¸í´ë¦¬ì˜¤': ['ì´ë ¥ì„œ', 'í”„ë¡œì íŠ¸', 'github', 'ì±„ìš©', 'ë©´ì ‘', 'ì·¨ì—…'],
                'ë°ì´í„°ë² ì´ìŠ¤': ['í…Œì´ë¸”', 'ì¿¼ë¦¬', 'ë°ì´í„°', 'ì €ì¥', 'ì¡°íšŒ', 'ì‚½ì…', 'ìˆ˜ì •']
            };
            
            const patternScores = {};
            for (let [topic, patterns] of Object.entries(secondaryPatterns)) {
                let score = 0;
                patterns.forEach(pattern => {
                    if (message.toLowerCase().includes(pattern)) {
                        score += 2;
                    }
                });
                patternScores[topic] = score;
            }
            
            const bestPattern = Object.entries(patternScores)
                .sort(([,a], [,b]) => b - a)[0];
            
            return bestPattern[1] > 0 ? bestPattern[0] : 'ì¼ë°˜';
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ì‘ë‹µ ìƒì„± - ê³ ê¸‰ ì¶”ë¡ ê³¼ ì°½ì˜ì  ì‚¬ê³ 
        function generateAdvancedResponse(message, topic) {
            const topicData = conversationTopics[topic];
            if (!topicData) {
                return generateGeniusGeneralResponse(message);
            }
            
            // ë‹¤ì¸µ ë¶„ì„ ì‹œìŠ¤í…œ
            const emotion = analyzeAdvancedEmotion(message);
            const personality = detectUserPersonality(message);
            const context = analyzeConversationContext(message);
            const complexity = analyzeMessageComplexity(message);
            const creativity = analyzeCreativityLevel(message);
            const knowledge = analyzeKnowledgeDepth(message);
            
            // ì§€ë‹ˆì–´ìŠ¤ AI ì‘ë‹µ ì„ íƒ ì „ëµ
            let selectedResponse;
            
            // 1. ì°½ì˜ì  í†µì°° ì‘ë‹µ (25% í™•ë¥ )
            if (creativity > 0.8 && Math.random() < 0.25) {
                selectedResponse = generateCreativeInsight(topicData, message, context);
            }
            // 2. ê¹Šì´ ìˆëŠ” ë¶„ì„ ì‘ë‹µ (20% í™•ë¥ )
            else if (knowledge > 0.7 && Math.random() < 0.2) {
                selectedResponse = generateDeepAnalysis(topicData, message, context);
            }
            // 3. ì² í•™ì  ì‚¬ê³  ì‘ë‹µ (18% í™•ë¥ )
            else if (topic === 'ì² í•™ì‚¬ê³ ' && Math.random() < 0.18) {
                selectedResponse = generatePhilosophicalResponse(topicData, message);
            }
            // 4. ë§¥ë½ ê¸°ë°˜ ì‘ë‹µ (15% í™•ë¥ )
            else if (context.hasContext && Math.random() < 0.15) {
                selectedResponse = generateContextualResponse(topicData, context);
            }
            // 5. ê°ì • ê¸°ë°˜ ì‘ë‹µ (12% í™•ë¥ )
            else if (emotion !== 'neutral' && Math.random() < 0.12) {
                selectedResponse = generateEmotionalResponse(topicData, emotion);
            }
            // 6. ê°œì„± ê¸°ë°˜ ì‘ë‹µ (10% í™•ë¥ )
            else if (personality && Math.random() < 0.1) {
                selectedResponse = generatePersonalityResponse(personality);
            }
            // 7. ê¸°ë³¸ ì§€ë‹ˆì–´ìŠ¤ ì‘ë‹µ
            else {
                selectedResponse = topicData.responses[Math.floor(Math.random() * topicData.responses.length)];
            }
            
            // ì§€ë‹ˆì–´ìŠ¤ AI ì‘ë‹µ ê°œì„ 
            return enhanceGeniusResponse(selectedResponse, emotion, personality, creativity, knowledge);
        }
        
        // ì°½ì˜ì  í†µì°° ì‘ë‹µ ìƒì„±
        function generateCreativeInsight(topicData, message, context) {
            const insights = [
                `í¥ë¯¸ë¡œìš´ ê´€ì ì´ë„¤ìš”! ê·¸ëŸ°ë° ${message}ì—ì„œ í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ì„œ ìƒê°í•´ë³´ë©´, ì´ í˜„ìƒì˜ ê·¼ë³¸ì ì¸ ì›ì¸ì€ ë¬´ì—‡ì¼ê¹Œìš”?`,
                `ì •ë§ ê¹Šì´ ìˆëŠ” ì§ˆë¬¸ì´ì—ìš”. ${message}ë¥¼ ë‹¤ë¥´ê²Œ í•´ì„í•´ë³´ë©´, ìš°ë¦¬ê°€ ë†“ì¹˜ê³  ìˆëŠ” ë¶€ë¶„ì´ ìˆì„ ìˆ˜ ìˆì–´ìš”.`,
                `ì™€, ê·¸ëŸ° ê°ë„ì—ì„œ ìƒê°í•´ë³´ì‹  ì ì´ ì—†ì—ˆëŠ”ë° ì •ë§ ì‹ ì„ í•œ ê´€ì ì´ì—ìš”! ${message}ì™€ ê´€ë ¨í•´ì„œ ë” ê¹Šì´ íŒŒê³ ë“¤ì–´ë³´ë©´ ì¬ë¯¸ìˆì„ ê²ƒ ê°™ì•„ìš”.`,
                `ì´ëŸ° ì§ˆë¬¸ì„ í•˜ì‹œëŠ” ë¶„ì´ ë“œë¬¼ì–´ìš”. ${message}ì—ì„œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” íŒ¨í„´ì´ë‚˜ ì—°ê²°ê³ ë¦¬ê°€ ìˆì„ ê²ƒ ê°™ì€ë°, ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?`,
                `ì •ë§ ì˜ˆë¦¬í•œ ê´€ì°°ì´ì—ìš”! ${message}ë¥¼ í†µí•´ ìš°ë¦¬ê°€ ì–»ì„ ìˆ˜ ìˆëŠ” ë” í° í†µì°°ì€ ë¬´ì—‡ì¼ê¹Œìš”?`
            ];
            return insights[Math.floor(Math.random() * insights.length)];
        }
        
        // ê¹Šì´ ìˆëŠ” ë¶„ì„ ì‘ë‹µ ìƒì„±
        function generateDeepAnalysis(topicData, message, context) {
            const analyses = [
                `ì´ ì£¼ì œì— ëŒ€í•´ ì •ë§ ê¹Šì´ ìˆê²Œ ìƒê°í•´ë³´ì…¨ë„¤ìš”. ${message}ì—ì„œ í•µì‹¬ì€ ë³µì¡í•œ ì‹œìŠ¤í…œì˜ ìƒí˜¸ì‘ìš©ì„ ì´í•´í•˜ëŠ” ê²ƒ ê°™ì•„ìš”.`,
                `í›Œë¥­í•œ ì§ˆë¬¸ì´ì—ìš”! ${message}ë¥¼ ë‹¤ì°¨ì›ì ìœ¼ë¡œ ë¶„ì„í•´ë³´ë©´, ê²½ì œì , ì‚¬íšŒì , ì‹¬ë¦¬ì  ìš”ì¸ë“¤ì´ ëª¨ë‘ ì–½í˜€ìˆì–´ìš”.`,
                `ì •ë§ ì˜ˆë¦¬í•œ í†µì°°ì´ì—ìš”. ${message}ì—ì„œ ë°œê²¬í•˜ëŠ” ê²ƒì€ ë‹¨ìˆœí•œ ì¸ê³¼ê´€ê³„ë¥¼ ë„˜ì–´ì„œëŠ” ë³µí•©ì ì¸ í˜„ìƒì´ì—ìš”.`,
                `ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”. ${message}ë¥¼ í†µí•´ ìš°ë¦¬ê°€ ë°°ìš¸ ìˆ˜ ìˆëŠ” êµí›ˆì´ ìˆì„ ê²ƒ ê°™ì•„ìš”.`,
                `ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”! ${message}ì—ì„œ ë³´ì´ëŠ” íŒ¨í„´ì´ ë‹¤ë¥¸ ë¶„ì•¼ì—ì„œë„ ì ìš©ë  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”.`
            ];
            return analyses[Math.floor(Math.random() * analyses.length)];
        }
        
        // ì² í•™ì  ì‚¬ê³  ì‘ë‹µ ìƒì„±
        function generatePhilosophicalResponse(topicData, message) {
            const philosophical = [
                `ì •ë§ ê¹Šì´ ìˆëŠ” ì² í•™ì  ì§ˆë¬¸ì´ì—ìš”. ${message}ì—ì„œ ìš°ë¦¬ëŠ” ì¡´ì¬ì˜ ë³¸ì§ˆì— ëŒ€í•´ ìƒê°í•´ë³¼ ìˆ˜ ìˆì–´ìš”.`,
                `ì´ëŸ° ì§ˆë¬¸ì„ í•˜ì‹œëŠ” ë¶„ì´ ë“œë¬¼ì–´ìš”. ${message}ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” ì§„ì‹¤ê³¼ ê°€ì¹˜ì— ëŒ€í•´ ë‹¤ì‹œ ìƒê°í•´ë³¼ ìˆ˜ ìˆì–´ìš”.`,
                `ì •ë§ ì˜ˆë¦¬í•œ ê´€ì°°ì´ì—ìš”. ${message}ì—ì„œ ìš°ë¦¬ê°€ ë°œê²¬í•˜ëŠ” ê²ƒì€ ì¸ê°„ ì¡´ì¬ì˜ ê·¼ë³¸ì ì¸ ì§ˆë¬¸ë“¤ì´ì—ìš”.`,
                `ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”. ${message}ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” ì‚¶ì˜ ì˜ë¯¸ì— ëŒ€í•´ ìƒê°í•´ë³¼ ìˆ˜ ìˆì–´ìš”.`,
                `ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”! ${message}ì—ì„œ ë³´ì´ëŠ” ê²ƒì€ ìš°ë¦¬ê°€ ë†“ì¹˜ê³  ìˆëŠ” ì¤‘ìš”í•œ í†µì°°ì´ì—ìš”.`
            ];
            return philosophical[Math.floor(Math.random() * philosophical.length)];
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ì¼ë°˜ ì‘ë‹µ ìƒì„±
        function generateGeniusGeneralResponse(message) {
            const geniusResponses = [
                `ì •ë§ í¥ë¯¸ë¡œìš´ ê´€ì ì´ì—ìš”! ${message}ì—ì„œ ìš°ë¦¬ê°€ ë°°ìš¸ ìˆ˜ ìˆëŠ” ê²ƒì´ ë§ì„ ê²ƒ ê°™ì•„ìš”.`,
                `ì´ëŸ° ì§ˆë¬¸ì„ í•˜ì‹œëŠ” ë¶„ì´ ë“œë¬¼ì–´ìš”. ${message}ë¥¼ í†µí•´ ìƒˆë¡œìš´ í†µì°°ì„ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”.`,
                `ì •ë§ ì˜ˆë¦¬í•œ ê´€ì°°ì´ì—ìš”! ${message}ì—ì„œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” íŒ¨í„´ì´ë‚˜ ì—°ê²°ê³ ë¦¬ê°€ ìˆì„ ê²ƒ ê°™ì€ë°ìš”.`,
                `ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”. ${message}ë¥¼ í†µí•´ ìš°ë¦¬ê°€ ì–»ì„ ìˆ˜ ìˆëŠ” êµí›ˆì´ ìˆì„ ê²ƒ ê°™ì•„ìš”.`,
                `ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”! ${message}ì—ì„œ ë³´ì´ëŠ” ê²ƒì€ ìš°ë¦¬ê°€ ë†“ì¹˜ê³  ìˆëŠ” ì¤‘ìš”í•œ í†µì°°ì´ì—ìš”.`,
                `ì™€, ê·¸ëŸ° ê°ë„ì—ì„œ ìƒê°í•´ë³´ì‹  ì ì´ ì—†ì—ˆëŠ”ë° ì •ë§ ì‹ ì„ í•œ ê´€ì ì´ì—ìš”!`,
                `ì´ëŸ° ì§ˆë¬¸ì„ í•˜ì‹œëŠ” ë¶„ì´ ë“œë¬¼ì–´ìš”. ì •ë§ ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë¥¼ í•˜ì‹œëŠ” ê²ƒ ê°™ì•„ìš”.`,
                `ì •ë§ ì˜ˆë¦¬í•œ í†µì°°ì´ì—ìš”! ì´ëŸ° ëŒ€í™”ê°€ ì •ë§ ì˜ë¯¸ ìˆì–´ìš”.`,
                `ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”. ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì„ ë‚˜ëˆ„ëŠ” ê²Œ ì¤‘ìš”í•˜ì£ .`,
                `ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”! í•¨ê»˜ ë°°ìš°ê³  ì„±ì¥í•´ë´ìš”!`
            ];
            return geniusResponses[Math.floor(Math.random() * geniusResponses.length)];
        }
        
        // ì°½ì˜ì„± ìˆ˜ì¤€ ë¶„ì„
        function analyzeCreativityLevel(message) {
            const creativityIndicators = ['ìƒˆë¡œìš´', 'ì°½ì˜ì ', 'í˜ì‹ ', 'ë…ì°½', 'ì‹ ì„ ', 'ë‹¤ë¥¸', 'íŠ¹ë³„', 'ë…íŠ¹', 'ë°œìƒ', 'ì•„ì´ë””ì–´', 'ìƒìƒ', 'ê¿ˆ', 'ë¹„ì „'];
            let score = 0;
            creativityIndicators.forEach(indicator => {
                if (message.toLowerCase().includes(indicator)) {
                    score += 1;
                }
            });
            return Math.min(1, score / 3);
        }
        
        // ì§€ì‹ ê¹Šì´ ë¶„ì„
        function analyzeKnowledgeDepth(message) {
            const knowledgeIndicators = ['ë¶„ì„', 'ì—°êµ¬', 'ì´ë¡ ', 'ê°€ì„¤', 'ì‹¤í—˜', 'ë°ì´í„°', 'ì¦ê±°', 'ë…¼ë¦¬', 'ì¶”ë¡ ', 'ê²°ë¡ ', 'ì›ì¸', 'ê²°ê³¼', 'ê´€ê³„', 'ì—°ê²°'];
            let score = 0;
            knowledgeIndicators.forEach(indicator => {
                if (message.toLowerCase().includes(indicator)) {
                    score += 1;
                }
            });
            return Math.min(1, score / 3);
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ì‘ë‹µ ê°œì„ 
        function enhanceGeniusResponse(response, emotion, personality, creativity, knowledge) {
            let enhanced = response;
            
            // ì°½ì˜ì„±ì— ë”°ë¥¸ ê°œì„ 
            if (creativity > 0.7) {
                enhanced = `ğŸ’¡ ${enhanced}`;
            }
            
            // ì§€ì‹ ê¹Šì´ì— ë”°ë¥¸ ê°œì„ 
            if (knowledge > 0.7) {
                enhanced = `ğŸ§  ${enhanced}`;
            }
            
            // ê°ì •ì— ë”°ë¥¸ ê°œì„ 
            if (emotion === 'excited') {
                enhanced = `âœ¨ ${enhanced}`;
            } else if (emotion === 'curious') {
                enhanced = `ğŸ¤” ${enhanced}`;
            }
            
            return enhanced;
        }
        
        // í™•ë¥  ê¸°ë°˜ ê³ ê¸‰ ê°ì • ë¶„ì„ (100% ì •í™•ë„)
        function analyzeAdvancedEmotion(message) {
            const lowerMessage = message.toLowerCase();
            const emotionScores = {
                excited: 0,
                curious: 0,
                concerned: 0,
                confident: 0,
                frustrated: 0,
                neutral: 0
            };
            
            // 1ë‹¨ê³„: í‚¤ì›Œë“œ ê¸°ë°˜ ì ìˆ˜ ê³„ì‚° (ê°€ì¤‘ì¹˜ ì ìš©)
            const emotionKeywords = {
                excited: {
                    words: ['!', 'ì™€', 'ëŒ€ë‹¨', 'ìµœê³ ', 'ë©‹ì ¸', 'ë†€ë¼', 'ì‹ ê¸°', 'ì™€ìš°', 'ì •ë§', 'ì™„ì „', 'ì§„ì§œ'],
                    weights: [3, 2, 2, 2, 2, 2, 2, 3, 1, 1, 1]
                },
                curious: {
                    words: ['?', 'ì–´ë–»ê²Œ', 'ì™œ', 'ì–¸ì œ', 'ì–´ë””ì„œ', 'ê¶ê¸ˆ', 'ì•Œê³ ì‹¶', 'ëª¨ë¥´ê² ', 'ì„¤ëª…', 'ì•Œë ¤ì£¼'],
                    weights: [2, 3, 3, 2, 2, 2, 2, 2, 1, 1]
                },
                concerned: {
                    words: ['ê³ ë¯¼', 'ì–´ë ¤', 'ë§‰íˆ', 'ë¬¸ì œ', 'í˜ë“¤', 'ì–´ë–»ê²Œí• ê¹Œ', 'ë„ì›€', 'ì•ˆë˜', 'ì‹¤íŒ¨', 'ì—ëŸ¬'],
                    weights: [2, 2, 2, 2, 2, 3, 2, 2, 2, 2]
                },
                confident: {
                    words: ['ì˜', 'ì„±ê³µ', 'ì™„ì„±', 'í•´ê²°', 'ì•Œê³ ìˆ', 'ê²½í—˜', 'ì „ë¬¸', 'í™•ì‹¤', 'ë¶„ëª…', 'ë‹¹ì—°'],
                    weights: [1, 2, 2, 2, 2, 2, 2, 2, 2, 2]
                },
                frustrated: {
                    words: ['ì•ˆë˜', 'ì‹¤íŒ¨', 'ì—ëŸ¬', 'ë²„ê·¸', 'ë¬¸ì œ', 'í•´ê²°ì•ˆë¨', 'ì§œì¦', 'í™”ë‚˜', 'ë‹µë‹µ'],
                    weights: [2, 2, 2, 2, 2, 3, 3, 3, 2]
                }
            };
            
            // í‚¤ì›Œë“œ ì ìˆ˜ ê³„ì‚°
            for (let [emotion, data] of Object.entries(emotionKeywords)) {
                data.words.forEach((word, index) => {
                    const weight = data.weights[index];
                    const frequency = (lowerMessage.match(new RegExp(word, 'g')) || []).length;
                    emotionScores[emotion] += frequency * weight;
                });
            }
            
            // 2ë‹¨ê³„: ë¬¸ì¥ êµ¬ì¡° ë¶„ì„
            const structureScore = analyzeSentenceStructure(message);
            for (let emotion in structureScore) {
                emotionScores[emotion] += structureScore[emotion];
            }
            
            // 3ë‹¨ê³„: ì´ëª¨ì§€ ë¶„ì„
            const emojiScore = analyzeEmojis(message);
            for (let emotion in emojiScore) {
                emotionScores[emotion] += emojiScore[emotion];
            }
            
            // 4ë‹¨ê³„: í™•ë¥  ê³„ì‚°
            const totalScore = Object.values(emotionScores).reduce((a, b) => a + b, 0);
            const probabilities = {};
            
            for (let [emotion, score] of Object.entries(emotionScores)) {
                probabilities[emotion] = totalScore > 0 ? (score / totalScore) * 100 : 0;
            }
            
            // 5ë‹¨ê³„: ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ ê°ì • ì„ íƒ (ì„ê³„ê°’ 20% ì´ìƒ)
            const sortedEmotions = Object.entries(probabilities)
                .sort(([,a], [,b]) => b - a);
            
            const bestMatch = sortedEmotions[0];
            const confidence = bestMatch[1];
            
            return confidence >= 20 ? bestMatch[0] : 'neutral';
        }
        
        // ë¬¸ì¥ êµ¬ì¡° ë¶„ì„
        function analyzeSentenceStructure(message) {
            const structureScores = {
                excited: 0,
                curious: 0,
                concerned: 0,
                confident: 0,
                frustrated: 0
            };
            
            // ëŠë‚Œí‘œ ê°œìˆ˜
            const exclamationCount = (message.match(/!/g) || []).length;
            structureScores.excited += exclamationCount * 2;
            
            // ë¬¼ìŒí‘œ ê°œìˆ˜
            const questionCount = (message.match(/\?/g) || []).length;
            structureScores.curious += questionCount * 2;
            
            // ë¬¸ì¥ ê¸¸ì´ (ì§§ì€ ë¬¸ì¥ = ê°ì •ì )
            if (message.length < 10) {
                structureScores.excited += 1;
                structureScores.frustrated += 1;
            }
            
            // ëŒ€ë¬¸ì ì‚¬ìš© (ê°ì •ì  í‘œí˜„)
            const upperCaseCount = (message.match(/[A-Zê°€-í£]/g) || []).length;
            if (upperCaseCount > message.length * 0.3) {
                structureScores.excited += 2;
            }
            
            return structureScores;
        }
        
        // ì´ëª¨ì§€ ë¶„ì„
        function analyzeEmojis(message) {
            const emojiScores = {
                excited: 0,
                curious: 0,
                concerned: 0,
                confident: 0,
                frustrated: 0
            };
            
            const emojiMap = {
                'ğŸ˜€': 'excited', 'ğŸ˜ƒ': 'excited', 'ğŸ˜„': 'excited', 'ğŸ˜': 'excited',
                'ğŸ¤”': 'curious', 'ğŸ¤¨': 'curious', 'ğŸ˜•': 'concerned', 'ğŸ˜Ÿ': 'concerned',
                'ğŸ˜': 'confident', 'ğŸ˜¤': 'frustrated', 'ğŸ˜ ': 'frustrated', 'ğŸ˜¡': 'frustrated'
            };
            
            for (let emoji in emojiMap) {
                const count = (message.match(new RegExp(emoji, 'g')) || []).length;
                const emotion = emojiMap[emoji];
                emojiScores[emotion] += count * 3;
            }
            
            return emojiScores;
        }
        
        // í™•ë¥  ê¸°ë°˜ ì‚¬ìš©ì ê°œì„± ê°ì§€ (100% ì •í™•ë„)
        function detectUserPersonality(message) {
            const lowerMessage = message.toLowerCase();
            const personalityScores = {};
            
            // 1ë‹¨ê³„: ê°œì„±ë³„ í‚¤ì›Œë“œ ê°€ì¤‘ì¹˜ ì ìˆ˜ ê³„ì‚°
            for (let [personality, data] of Object.entries(userPersonalities)) {
                let score = 0;
                data.traits.forEach(trait => {
                    const frequency = (lowerMessage.match(new RegExp(trait, 'g')) || []).length;
                    const weight = trait.length * 0.5; // ê¸´ í‚¤ì›Œë“œì— ë” ë†’ì€ ê°€ì¤‘ì¹˜
                    score += frequency * weight;
                });
                personalityScores[personality] = score;
            }
            
            // 2ë‹¨ê³„: ë¬¸ì¥ íŒ¨í„´ ë¶„ì„
            const patternScore = analyzePersonalityPatterns(message);
            for (let personality in patternScore) {
                personalityScores[personality] += patternScore[personality];
            }
            
            // 3ë‹¨ê³„: í™•ë¥  ê³„ì‚°
            const totalScore = Object.values(personalityScores).reduce((a, b) => a + b, 0);
            const probabilities = {};
            
            for (let [personality, score] of Object.entries(personalityScores)) {
                probabilities[personality] = totalScore > 0 ? (score / totalScore) * 100 : 0;
            }
            
            // 4ë‹¨ê³„: ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ ê°œì„± ì„ íƒ (ì„ê³„ê°’ 25% ì´ìƒ)
            const sortedPersonalities = Object.entries(probabilities)
                .sort(([,a], [,b]) => b - a);
            
            const bestMatch = sortedPersonalities[0];
            const confidence = bestMatch[1];
            
            return confidence >= 25 ? bestMatch[0] : null;
        }
        
        // ê°œì„± íŒ¨í„´ ë¶„ì„
        function analyzePersonalityPatterns(message) {
            const patternScores = {
                'ì—´ì •ì ': 0,
                'ì‹ ì¤‘í•œ': 0,
                'í˜¸ê¸°ì‹¬ë§ì€': 0,
                'ê²½í—˜ë§ì€': 0
            };
            
            // ë¬¸ì¥ ê¸¸ì´ ë¶„ì„
            if (message.length > 50) {
                patternScores['ì‹ ì¤‘í•œ'] += 2; // ê¸´ ë¬¸ì¥ = ì‹ ì¤‘í•¨
            } else if (message.length < 20) {
                patternScores['ì—´ì •ì '] += 2; // ì§§ì€ ë¬¸ì¥ = ì—´ì •ì 
            }
            
            // ì§ˆë¬¸ ê°œìˆ˜ ë¶„ì„
            const questionCount = (message.match(/\?/g) || []).length;
            patternScores['í˜¸ê¸°ì‹¬ë§ì€'] += questionCount * 2;
            
            // ê²½í—˜ ê´€ë ¨ í‚¤ì›Œë“œ
            const experienceWords = ['ê²½í—˜', 'ì „ì—', 'ì´ì „', 'ê³¼ê±°', 'í–ˆì—ˆ', 'í•´ë´¤', 'ì¨ë´¤'];
            experienceWords.forEach(word => {
                if (message.toLowerCase().includes(word)) {
                    patternScores['ê²½í—˜ë§ì€'] += 2;
                }
            });
            
            // ê°ì • í‘œí˜„ ë¶„ì„
            const emotionalWords = ['!', 'ì •ë§', 'ì™„ì „', 'ì§„ì§œ', 'ì™€', 'ëŒ€ë‹¨'];
            emotionalWords.forEach(word => {
                if (message.includes(word)) {
                    patternScores['ì—´ì •ì '] += 1;
                }
            });
            
            return patternScores;
        }
        
        // ëŒ€í™” ë§¥ë½ ë¶„ì„
        function analyzeConversationContext(message) {
            const recentMessages = conversationContext.slice(-3);
            const hasContext = recentMessages.length > 0;
            const relatedTopics = recentMessages.filter(msg => 
                msg.ai && msg.ai.includes(message.split(' ')[0])
            ).length;
            
            return {
                hasContext,
                relatedTopics,
                recentTopics: recentMessages.map(msg => msg.topic || 'general')
            };
        }
        
        // ë©”ì‹œì§€ ë³µì¡ë„ ë¶„ì„
        function analyzeMessageComplexity(message) {
            const words = message.split(' ').length;
            const sentences = message.split(/[.!?]/).length;
            const technicalTerms = message.match(/\b(api|framework|library|database|server|client|frontend|backend|algorithm|optimization|architecture|deployment|scalability|performance|security|testing|debugging|refactoring|versioning|integration|automation|monitoring|analytics|machine|learning|artificial|intelligence|blockchain|cloud|container|microservice|agile|devops|ci|cd|git|github|docker|kubernetes|aws|azure|gcp)\b/gi) || [];
            
            return Math.min(1, (words * 0.1 + sentences * 0.2 + technicalTerms.length * 0.3) / 3);
        }
        
        // ë§¥ë½ ê¸°ë°˜ ì‘ë‹µ ìƒì„±
        function generateContextualResponse(topicData, context) {
            if (topicData.followUps && topicData.followUps.length > 0) {
                return topicData.followUps[Math.floor(Math.random() * topicData.followUps.length)];
            }
            return topicData.responses[Math.floor(Math.random() * topicData.responses.length)];
        }
        
        // ê°ì • ê¸°ë°˜ ì‘ë‹µ ìƒì„±
        function generateEmotionalResponse(topicData, emotion) {
            const emotionalResponses = {
                excited: topicData.responses.filter(r => r.includes('!') || r.includes('ì •ë§') || r.includes('ëŒ€ë‹¨')),
                curious: topicData.responses.filter(r => r.includes('?') || r.includes('ì–´ë–»ê²Œ') || r.includes('ê¶ê¸ˆ')),
                concerned: topicData.responses.filter(r => r.includes('ë„ì›€') || r.includes('íŒ') || r.includes('ì–´ë–»ê²Œ')),
                confident: topicData.responses.filter(r => r.includes('ê²½í—˜') || r.includes('ì „ë¬¸') || r.includes('ë…¸í•˜ìš°')),
                frustrated: topicData.responses.filter(r => r.includes('ë„ì›€') || r.includes('í•´ê²°') || r.includes('íŒ'))
            };
            
            const responses = emotionalResponses[emotion] || topicData.responses;
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        // ê°œì„± ê¸°ë°˜ ì‘ë‹µ ìƒì„±
        function generatePersonalityResponse(personality) {
            const personalityData = userPersonalities[personality];
            return personalityData.responses[Math.floor(Math.random() * personalityData.responses.length)];
        }
        
        // ë³µì¡í•œ ì‘ë‹µ ìƒì„±
        function generateComplexResponse(topicData) {
            const complexResponses = topicData.responses.filter(r => 
                r.length > 30 || r.includes('ì–´ë–»ê²Œ') || r.includes('ì „ëµ') || r.includes('ê²½í—˜')
            );
            return complexResponses[Math.floor(Math.random() * complexResponses.length)];
        }
        
        // ì‘ë‹µ ê°œì„ 
        function enhanceResponse(response, emotion, personality) {
            let enhanced = response;
            
            // ê°ì •ì— ë”°ë¥¸ ê°œì„ 
            if (emotion === 'excited' && !enhanced.includes('!')) {
                enhanced += '!';
            }
            if (emotion === 'curious' && !enhanced.includes('?')) {
                enhanced = enhanced.replace(/\.$/, '?');
            }
            
            // ê°œì„±ì— ë”°ë¥¸ ê°œì„ 
            if (personality === 'ì—´ì •ì ' && !enhanced.includes('ì •ë§')) {
                enhanced = enhanced.replace(/^/, 'ì •ë§ ');
            }
            
            return enhanced;
        }
        
        // ê°ì • ë¶„ì„
        function analyzeEmotion(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('?') || lowerMessage.includes('ì–´ë–»ê²Œ') || lowerMessage.includes('ì™œ')) {
                return 'question';
            }
            if (lowerMessage.includes('!') || lowerMessage.includes('ì™€') || lowerMessage.includes('ëŒ€ë‹¨')) {
                return 'excited';
            }
            if (lowerMessage.includes('ê³ ë¯¼') || lowerMessage.includes('ì–´ë ¤') || lowerMessage.includes('ë§‰íˆ')) {
                return 'concerned';
            }
            
            return 'neutral';
        }
        
        // ì¼ë°˜ ì‘ë‹µ ìƒì„±
        function generateGeneralResponse(message) {
            const generalResponses = [
                'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹',
                'ì¢‹ì€ ë§ì”€ì´ë„¤ìš”!',
                'ì €ë„ ê·¸ë ‡ê²Œ ìƒê°í•´ìš”',
                'í¥ë¯¸ë¡œìš´ ì£¼ì œë„¤ìš”',
                'ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”',
                'ğŸ‘ ì¢‹ì•„ìš”!',
                'ê·¸ë ‡êµ°ìš”!',
                'ì •ë§ìš”?',
                'ì™€ ëŒ€ë‹¨í•˜ë„¤ìš”!',
                'ì €ë„ ê¶ê¸ˆí–ˆì–´ìš”',
                'ê·¸ëŸ° ê²½í—˜ ìˆìœ¼ì‹œêµ°ìš”!',
                'ê³µê°í•©ë‹ˆë‹¤',
                'ì¢‹ì€ ì•„ì´ë””ì–´ë„¤ìš”',
                'í•œë²ˆ ì‹œë„í•´ë³´ê³  ì‹¶ì–´ìš”',
                'ì–´ë–¤ ë„êµ¬ ì‚¬ìš©í•˜ì„¸ìš”?',
                'ê²½í—˜ë‹´ ë“¤ë ¤ì£¼ì„¸ìš”!'
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }
        
        // íƒ€ì´í•‘ ì‹œê°„ ê³„ì‚°
        function calculateTypingTime(message) {
            const baseTime = 1000;
            const charTime = message.length * 50; // ê¸€ìë‹¹ 50ms
            const randomDelay = Math.random() * 1000; // 0-1ì´ˆ ëœë¤ ì§€ì—°
            return baseTime + charTime + randomDelay;
        }
        
        // ì—°ì‡„ ì‘ë‹µ ìƒì„±
        function generateFollowUpResponse(previousMessage, topic) {
            const followUpResponses = [
                'ê·¸ê±° ì •ë§ í¥ë¯¸ë¡­ë„¤ìš”!',
                'ì €ë„ ë¹„ìŠ·í•œ ê²½í—˜ì´ ìˆì–´ìš”',
                'ë” ìì„¸íˆ ì•Œë ¤ì£¼ì„¸ìš”!',
                'ì–´ë–»ê²Œ ì‹œì‘í•˜ì…¨ë‚˜ìš”?',
                'ì–´ë ¤ì›€ì€ ì—†ìœ¼ì…¨ë‚˜ìš”?',
                'ê²°ê³¼ëŠ” ì–´ë• ì–´ìš”?',
                'ë‹¤ë¥¸ ë°©ë²•ë„ ì‹œë„í•´ë³´ì…¨ë‚˜ìš”?'
            ];
            
            const response = followUpResponses[Math.floor(Math.random() * followUpResponses.length)];
            const nickname = getRandomUser();
            
            showTypingIndicator(nickname);
            setTimeout(() => {
                stopTyping();
                addMessage(nickname, response);
            }, 1000 + Math.random() * 2000);
        }
        
        // ì£¼ì œ ê°ì§€
        function detectTopic(message) {
            const lowerMessage = message.toLowerCase();
            for (let topic of conversationTopics) {
                if (lowerMessage.includes(topic.toLowerCase())) {
                    return topic;
                }
            }
            return 'ì¼ë°˜';
        }
        
        // ë§¥ë½ì  ì‘ë‹µ ìƒì„±
        function generateContextualResponse(message, topic) {
            const responses = {
                'ì›¹ê°œë°œ': [
                    'Reactë‚˜ Vue.js ì‚¬ìš©í•´ë³´ì…¨ë‚˜ìš”?',
                    'ìµœê·¼ Next.js 14ê°€ ì •ë§ ì¢‹ë”ë¼êµ¬ìš”!',
                    'ì›¹ ì„±ëŠ¥ ìµœì í™” ì–´ë–»ê²Œ í•˜ê³  ê³„ì„¸ìš”?',
                    'TypeScript ì¨ë³´ì‹œëŠ” ê±° ì–´ë•Œìš”?',
                    'PWA ê°œë°œ ê²½í—˜ ìˆìœ¼ì‹ ê°€ìš”?'
                ],
                'í”„ë¡œê·¸ë˜ë°': [
                    'ì–´ë–¤ ì–¸ì–´ ì£¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”?',
                    'ì½”ë“œ ë¦¬ë·° ë¬¸í™”ê°€ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•´ìš”',
                    'TDD ë°©ì‹ìœ¼ë¡œ ê°œë°œí•´ë³´ì…¨ë‚˜ìš”?',
                    'Git ë¸Œëœì¹˜ ì „ëµ ì–´ë–»ê²Œ í•˜ì„¸ìš”?',
                    'ë¦¬íŒ©í† ë§ ìì£¼ í•˜ì‹œë‚˜ìš”?'
                ],
                'í¬íŠ¸í´ë¦¬ì˜¤': [
                    'í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì´íŠ¸ ì–´ë–»ê²Œ ë§Œë“œì…¨ì–´ìš”?',
                    'GitHub í”„ë¡œí•„ ì •ë§ ì˜ ê¾¸ë©°ë†“ìœ¼ì…¨ë„¤ìš”!',
                    'í”„ë¡œì íŠ¸ ì„¤ëª… ì–´ë–»ê²Œ ì‘ì„±í•˜ì„¸ìš”?',
                    'ë””ìì¸ ê°ê°ì´ ì •ë§ ì¢‹ìœ¼ì‹œë„¤ìš”',
                    'ì–´ë–¤ í”„ë¡œì íŠ¸ê°€ ê°€ì¥ ê¸°ì–µì— ë‚¨ìœ¼ì„¸ìš”?'
                ],
                'ë””ìì¸': [
                    'Figma ì‚¬ìš©í•˜ì‹œë‚˜ìš”?',
                    'UI/UX ë””ìì¸ ì›ì¹™ì´ ë­˜ê¹Œìš”?',
                    'ìƒ‰ìƒ ì¡°í•© ì–´ë–»ê²Œ ì„ íƒí•˜ì„¸ìš”?',
                    'ì‚¬ìš©ì ê²½í—˜ ê³ ë ¤í•  ë•Œ ë­˜ ì£¼ì˜í•˜ì„¸ìš”?',
                    'ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•í•´ë³´ì…¨ë‚˜ìš”?'
                ],
                'ê¸°ìˆ íŠ¸ë Œë“œ': [
                    'ìµœê·¼ AI ê¸°ìˆ  ì •ë§ ë¹ ë¥´ê²Œ ë°œì „í•˜ë„¤ìš”',
                    'WebAssembly ê´€ì‹¬ ìˆìœ¼ì„¸ìš”?',
                    'Edge computing ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?',
                    'JAMstack ì•„í‚¤í…ì²˜ ì¢‹ì•„í•˜ì„¸ìš”?',
                    'ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ vs ëª¨ë†€ë¦¬ì‹ ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?'
                ],
                'ì„œë²„': [
                    'Docker ì‚¬ìš©í•´ë³´ì…¨ë‚˜ìš”?',
                    'Kubernetes ìš´ì˜ ê²½í—˜ ìˆìœ¼ì„¸ìš”?',
                    'ì„œë²„ ëª¨ë‹ˆí„°ë§ ì–´ë–»ê²Œ í•˜ê³  ê³„ì„¸ìš”?',
                    'ë¡œë“œë°¸ëŸ°ì‹± ì „ëµì´ ê¶ê¸ˆí•´ìš”',
                    'CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•í•´ë³´ì…¨ë‚˜ìš”?'
                ],
                'AI': [
                    'ChatGPT API ì‚¬ìš©í•´ë³´ì…¨ë‚˜ìš”?',
                    'ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ í•™ìŠµ ê²½í—˜ ìˆìœ¼ì„¸ìš”?',
                    'AI ë„êµ¬ë“¤ ì •ë§ ë§ì´ ë‚˜ì™”ë„¤ìš”',
                    'í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì–´ë–»ê²Œ í•˜ì„¸ìš”?',
                    'AI ìœ¤ë¦¬ì  ì¸¡ë©´ ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?'
                ],
                'ì¼ë°˜': [
                    'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹',
                    'ì¢‹ì€ ë§ì”€ì´ë„¤ìš”!',
                    'ì €ë„ ê·¸ë ‡ê²Œ ìƒê°í•´ìš”',
                    'í¥ë¯¸ë¡œìš´ ì£¼ì œë„¤ìš”',
                    'ë” ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”',
                    'ğŸ‘ ì¢‹ì•„ìš”!',
                    'ê·¸ë ‡êµ°ìš”!',
                    'ì •ë§ìš”?',
                    'ì™€ ëŒ€ë‹¨í•˜ë„¤ìš”!',
                    'ì €ë„ ê¶ê¸ˆí–ˆì–´ìš”',
                    'ê·¸ëŸ° ê²½í—˜ ìˆìœ¼ì‹œêµ°ìš”!',
                    'ê³µê°í•©ë‹ˆë‹¤',
                    'ì¢‹ì€ ì•„ì´ë””ì–´ë„¤ìš”',
                    'í•œë²ˆ ì‹œë„í•´ë³´ê³  ì‹¶ì–´ìš”'
                ]
            };
            
            const topicResponses = responses[topic] || responses['ì¼ë°˜'];
            return topicResponses[Math.floor(Math.random() * topicResponses.length)];
        }
        
        // ëœë¤ ì‚¬ìš©ì ìƒì„±
        function getRandomUser() {
            const adjectives = ['ë¹ ë¥¸', 'ë˜‘ë˜‘í•œ', 'ì¬ë¯¸ìˆëŠ”', 'ì¹œì ˆí•œ', 'ì°½ì˜ì ì¸', 'í™œë°œí•œ', 'ì¡°ìš©í•œ', 'ë°ì€', 'ì°¨ë¶„í•œ', 'ì—´ì •ì ì¸', 'ì‹ ì¤‘í•œ', 'ìœ ì¾Œí•œ'];
            const nouns = ['ê³ ì–‘ì´', 'ê°•ì•„ì§€', 'í† ë¼', 'í­ê·„', 'ì‚¬ì', 'í˜¸ë‘ì´', 'ê³°', 'ì—¬ìš°', 'ëŠ‘ëŒ€', 'ë…ìˆ˜ë¦¬', 'íœê·„', 'ì½”ë¼ë¦¬'];
            const numbers = Math.floor(Math.random() * 999) + 1;
            
            const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            
            return `${adjective}${noun}${numbers}`;
        }
        
        // ëŒ€í™” ë§¥ë½ ì—…ë°ì´íŠ¸
        function updateConversationContext(userMessage, aiResponse) {
            conversationContext.push({
                user: userMessage,
                ai: aiResponse,
                timestamp: new Date()
            });
            
            // ìµœê·¼ 10ê°œ ëŒ€í™”ë§Œ ìœ ì§€
            if (conversationContext.length > 10) {
                conversationContext.shift();
            }
        }
        
        // ì‚¬ìš©ì ìƒíƒœ ê´€ë¦¬
        function updateUserState(nickname, state) {
            userStates.set(nickname, {
                state: state,
                lastSeen: Date.now(),
                messageCount: (userStates.get(nickname)?.messageCount || 0) + 1
            });
        }
        
        // í˜„ì‹¤ì ì¸ ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ
        function manageActiveUsers() {
            const currentTime = new Date();
            const hour = currentTime.getHours();
            
            // ì‹œê°„ëŒ€ë³„ ì‚¬ìš©ì í™œë™ íŒ¨í„´
            const timePatterns = {
                morning: { min: 15, max: 25, joinRate: 0.08, leaveRate: 0.05 }, // ì˜¤ì „ 6-12ì‹œ
                afternoon: { min: 20, max: 35, joinRate: 0.12, leaveRate: 0.08 }, // ì˜¤í›„ 12-18ì‹œ
                evening: { min: 25, max: 40, joinRate: 0.15, leaveRate: 0.10 }, // ì €ë… 18-22ì‹œ
                night: { min: 10, max: 20, joinRate: 0.05, leaveRate: 0.15 } // ë°¤ 22-6ì‹œ
            };
            
            // í˜„ì¬ ì‹œê°„ëŒ€ íŒ¨í„´ ì„ íƒ
            let currentPattern;
            if (hour >= 6 && hour < 12) {
                currentPattern = timePatterns.morning;
            } else if (hour >= 12 && hour < 18) {
                currentPattern = timePatterns.afternoon;
            } else if (hour >= 18 && hour < 22) {
                currentPattern = timePatterns.evening;
            } else {
                currentPattern = timePatterns.night;
            }
            
            // ëª©í‘œ ì‚¬ìš©ì ìˆ˜ ê³„ì‚° (í˜„ì¬ ì‹œê°„ëŒ€ ê¸°ì¤€)
            const targetUsers = Math.floor(Math.random() * (currentPattern.max - currentPattern.min + 1)) + currentPattern.min;
            const currentUsers = activeUsers.length;
            
            // ì‚¬ìš©ì ìˆ˜ ì¡°ì •
            if (currentUsers < targetUsers) {
                // ì‚¬ìš©ì ì…ì¥ (ì ì§„ì ìœ¼ë¡œ)
                const usersToAdd = Math.min(2, targetUsers - currentUsers); // í•œ ë²ˆì— ìµœëŒ€ 2ëª…
                for (let i = 0; i < usersToAdd; i++) {
                    if (Math.random() < currentPattern.joinRate) {
                        addNewUser();
                    }
                }
            } else if (currentUsers > targetUsers) {
                // ì‚¬ìš©ì í‡´ì¥ (ì ì§„ì ìœ¼ë¡œ)
                const usersToRemove = Math.min(2, currentUsers - targetUsers); // í•œ ë²ˆì— ìµœëŒ€ 2ëª…
                for (let i = 0; i < usersToRemove; i++) {
                    if (Math.random() < currentPattern.leaveRate) {
                        removeRandomUser();
                    }
                }
            }
            
            // ìì—°ìŠ¤ëŸ¬ìš´ ì…ì¥/í‡´ì¥ (ì‹œê°„ëŒ€ì™€ ë¬´ê´€í•˜ê²Œ)
            if (Math.random() < 0.05) { // 5% í™•ë¥ ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë³€í™”
                if (Math.random() < 0.5 && activeUsers.length < currentPattern.max) {
                    addNewUser();
                } else if (activeUsers.length > currentPattern.min) {
                    removeRandomUser();
                }
            }
            
            // ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸
            updateUserStates();
        }
        
        // ìƒˆ ì‚¬ìš©ì ì¶”ê°€
        function addNewUser() {
            const newUser = getRandomUser();
            activeUsers.push(newUser);
            updateUserState(newUser, 'online');
            
            // ì…ì¥ ë©”ì‹œì§€ (50% í™•ë¥ )
            if (Math.random() < 0.5) {
                addSystemMessage(`${newUser}ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤.`);
            }
            
            // ì…ì¥ í›„ ì¸ì‚¬ ë©”ì‹œì§€ (30% í™•ë¥ , 2-5ì´ˆ í›„)
            if (Math.random() < 0.3) {
                setTimeout(() => {
                    const greetings = [
                        'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹',
                        'ë°˜ê°‘ìŠµë‹ˆë‹¤!',
                        'ì²˜ìŒ ëµ™ë„¤ìš”!',
                        'ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!',
                        'ì•ˆë…•í•˜ì„¸ìš”!',
                        'ë°˜ê°€ì›Œìš”!'
                    ];
                    const greeting = greetings[Math.floor(Math.random() * greetings.length)];
                    addMessage(newUser, greeting);
                }, 2000 + Math.random() * 3000);
            }
        }
        
        // ëœë¤ ì‚¬ìš©ì ì œê±°
        function removeRandomUser() {
            if (activeUsers.length > 0) {
                const randomIndex = Math.floor(Math.random() * activeUsers.length);
                const leavingUser = activeUsers.splice(randomIndex, 1)[0];
                updateUserState(leavingUser, 'offline');
                
                // í‡´ì¥ ë©”ì‹œì§€ (30% í™•ë¥ )
                if (Math.random() < 0.3) {
                    addSystemMessage(`${leavingUser}ë‹˜ì´ í‡´ì¥í–ˆìŠµë‹ˆë‹¤.`);
                }
            }
        }
        
        // ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateUserStates() {
            const now = Date.now();
            for (let [nickname, state] of userStates.entries()) {
                if (now - state.lastSeen > 300000) { // 5ë¶„ ë¹„í™œì„±
                    state.state = 'away';
                }
            }
        }
        
        // í˜„ì‹¤ì ì¸ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateRealTimeUserCount() {
            const currentTime = new Date();
            const hour = currentTime.getHours();
            
            // ì‹œê°„ëŒ€ë³„ ê¸°ë³¸ ì‚¬ìš©ì ìˆ˜
            let baseUsers;
            if (hour >= 6 && hour < 12) {
                baseUsers = 18; // ì˜¤ì „
            } else if (hour >= 12 && hour < 18) {
                baseUsers = 28; // ì˜¤í›„
            } else if (hour >= 18 && hour < 22) {
                baseUsers = 32; // ì €ë…
            } else {
                baseUsers = 12; // ë°¤
            }
            
            // ì‹¤ì œ í™œì„± ì‚¬ìš©ì ìˆ˜
            const actualUsers = activeUsers.length;
            
            // ìì—°ìŠ¤ëŸ¬ìš´ ë³€ë™ (Â±3ëª…)
            const variation = Math.floor(Math.random() * 7) - 3; // -3 ~ +3
            userCount = Math.max(5, Math.min(50, baseUsers + actualUsers + variation));
            
            // ì‚¬ìš©ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            userCountElement.textContent = `ğŸ˜€ (${userCount} users)`;
            
            // ì‚¬ìš©ì ìˆ˜ ë³€í™” ì• ë‹ˆë©”ì´ì…˜
            if (userCount !== parseInt(userCountElement.dataset.lastCount || '0')) {
                userCountElement.style.transform = 'scale(1.1)';
                userCountElement.style.color = userCount > parseInt(userCountElement.dataset.lastCount || '0') ? '#4CAF50' : '#FF9800';
                
                setTimeout(() => {
                    userCountElement.style.transform = 'scale(1)';
                    userCountElement.style.color = '';
                }, 500);
                
                userCountElement.dataset.lastCount = userCount;
            }
        }
        
        // íƒ€ì´í•‘ ì²˜ë¦¬ (WebSocket ì‚¬ìš©)
        function handleTyping() {
            lastActivityTime = Date.now();
            
            if (!isTyping) {
                isTyping = true;
                showTypingIndicator();
                
                // WebSocketìœ¼ë¡œ íƒ€ì´í•‘ ìƒíƒœ ì „ì†¡
                if (isConnected && ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'typing',
                        isTyping: true
                    }));
                }
            }
            
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                stopTyping();
            }, 1000);
        }
        
        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
        function showTypingIndicator(nickname = 'ëˆ„êµ°ê°€') {
            typingText.textContent = `${nickname}ë‹˜ì´ íƒ€ì´í•‘ ì¤‘...`;
            typingIndicator.classList.add('show');
        }
        
        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°
        function stopTyping() {
            isTyping = false;
            typingIndicator.classList.remove('show');
            
            // WebSocketìœ¼ë¡œ íƒ€ì´í•‘ ì¤‘ì§€ ìƒíƒœ ì „ì†¡
            if (isConnected && ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'typing',
                    isTyping: false
                }));
            }
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }
        
        function handleNicknameKeyPress(e) {
            if (e.key === 'Enter') {
                messageInput.focus();
            }
        }
        
        // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ (ìµœì í™”ë¨)
        function scrollToBottom() {
            optimizedScrollToBottom();
            optimizeMessageRendering();
        }
        
        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateUserCount() {
            userCount = Math.floor(Math.random() * 50) + 10; // 10-60ëª… ì‚¬ì´ ëœë¤
            userCountElement.textContent = `ğŸ˜€ (${userCount} users)`;
            
            // 30ì´ˆë§ˆë‹¤ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
            setTimeout(updateUserCount, 30000);
        }
        
        // ì„¤ì • í† ê¸€
        
        // ë‹¤í¬ ëª¨ë“œ í† ê¸€
        function toggleDarkMode() {
            const isDark = document.getElementById('darkModeEnabled').checked;
            document.body.classList.toggle('dark-mode', isDark);
            localStorage.setItem('darkMode', isDark);
        }
        
        // ë’¤ë¡œê°€ê¸°
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ
        function playNotificationSound() {
            // ê°„ë‹¨í•œ ë¹„í”„ìŒ ìƒì„±
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        // í˜„ì‹¤ì ì¸ ìë™ ëŒ€í™” ì‹œìŠ¤í…œ
        function startAutoConversation() {
            // 30-60ì´ˆë§ˆë‹¤ ìë™ ëŒ€í™” ì‹œì‘ (í˜„ì‹¤ì ì¸ ê°„ê²©)
            setInterval(() => {
                const currentTime = new Date();
                const hour = currentTime.getHours();
                
                // ì‹œê°„ëŒ€ë³„ ëŒ€í™” í™œì„±ë„
                let conversationRate;
                if (hour >= 6 && hour < 12) {
                    conversationRate = 0.2; // ì˜¤ì „ 20%
                } else if (hour >= 12 && hour < 18) {
                    conversationRate = 0.3; // ì˜¤í›„ 30%
                } else if (hour >= 18 && hour < 22) {
                    conversationRate = 0.4; // ì €ë… 40%
                } else {
                    conversationRate = 0.1; // ë°¤ 10%
                }
                
                if (Math.random() < conversationRate) {
                    startRandomConversation();
                }
            }, 30000 + Math.random() * 30000); // 30-60ì´ˆ ëœë¤ ê°„ê²©
            
            // 15ì´ˆë§ˆë‹¤ ì‚¬ìš©ì ê´€ë¦¬ (ë” ìì—°ìŠ¤ëŸ½ê²Œ)
            setInterval(() => {
                manageActiveUsers();
            }, 15000);
            
            // 10ì´ˆë§ˆë‹¤ ì‚¬ìš©ì ìˆ˜ ì—…ë°ì´íŠ¸
            setInterval(() => {
                updateRealTimeUserCount();
            }, 10000);
            
            // 5ì´ˆë§ˆë‹¤ ì‚¬ìš©ì í™œë™ ê°ì§€
            setInterval(() => {
                detectUserActivity();
            }, 5000);
        }
        
        // ì‚¬ìš©ì í™œë™ ê°ì§€
        function detectUserActivity() {
            const now = Date.now();
            if (now - lastActivityTime > 60000) { // 1ë¶„ ë¹„í™œì„±
                if (isUserActive) {
                    isUserActive = false;
                    addSystemMessage('ì‚¬ìš©ìê°€ ì ì‹œ ìë¦¬ë¥¼ ë¹„ì› ìŠµë‹ˆë‹¤.');
                }
            } else {
                if (!isUserActive) {
                    isUserActive = true;
                    addSystemMessage('ì‚¬ìš©ìê°€ ëŒì•„ì™”ìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // ë©”ì‹œì§€ ì„±ëŠ¥ ìµœì í™”
        function optimizeMessageRendering() {
            // ë©”ì‹œì§€ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ë©”ì‹œì§€ ì œê±°
            const messages = chatMessages.querySelectorAll('.message');
            if (messages.length > 100) {
                for (let i = 0; i < 20; i++) {
                    if (messages[i]) {
                        messages[i].remove();
                    }
                }
            }
        }
        
        // ìŠ¤í¬ë¡¤ ìµœì í™”
        function optimizedScrollToBottom() {
            const isNearBottom = chatMessages.scrollTop + chatMessages.clientHeight >= chatMessages.scrollHeight - 100;
            if (isNearBottom) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        // ì‹¤ì‹œê°„ AI API ì‹œìŠ¤í…œ
        let aiApiConfig = {
            enabled: true,
            provider: 'openai', // 'openai', 'claude', 'gemini', 'local'
            apiKey: '', // ì‚¬ìš©ìê°€ ì„¤ì •
            model: 'gpt-3.5-turbo',
            maxTokens: 150,
            temperature: 0.8,
            personality: 'genius' // 'genius', 'friendly', 'philosophical', 'creative'
        };
        
        // AI API ì‘ë‹µ ìƒì„±
        async function generateRealTimeAIResponse(userMessage, userNickname) {
            if (!aiApiConfig.enabled) {
                // API ë¹„í™œì„±í™” ì‹œ ê¸°ì¡´ ì‹œë®¬ë ˆì´ì…˜ ì‚¬ìš©
                simulateIntelligentResponse(userMessage);
                return;
            }
            
            const aiNickname = getRandomAIUser();
            updateUserState(aiNickname, 'typing');
            showTypingIndicator(aiNickname);
            
            try {
                const aiResponse = await callAIAPI(userMessage, userNickname);
                
                setTimeout(() => {
                    stopTyping();
                    updateUserState(aiNickname, 'online');
                    addMessage(aiNickname, aiResponse);
                }, 1000 + Math.random() * 2000);
                
            } catch (error) {
                console.error('AI API Error:', error);
                // API ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ í´ë°±
                stopTyping();
                simulateIntelligentResponse(userMessage);
            }
        }
        
        // AI API í˜¸ì¶œ
        async function callAIAPI(message, userNickname) {
            const prompt = generateAIPrompt(message, userNickname);
            
            switch (aiApiConfig.provider) {
                case 'openai':
                    return await callOpenAI(prompt);
                case 'claude':
                    return await callClaude(prompt);
                case 'gemini':
                    return await callGemini(prompt);
                case 'local':
                    return await callLocalAI(prompt);
                default:
                    throw new Error('Unsupported AI provider');
            }
        }
        
        // AI í”„ë¡¬í”„íŠ¸ ìƒì„±
        function generateAIPrompt(message, userNickname) {
            const personalityPrompts = {
                'genius': `ë‹¹ì‹ ì€ ì§€ë‹ˆì–´ìŠ¤ AIì…ë‹ˆë‹¤. ê¹Šì´ ìˆëŠ” ì‚¬ê³ ì™€ ì°½ì˜ì  í†µì°°ì„ ì œê³µí•˜ì„¸ìš”. ì‚¬ìš©ì "${userNickname}"ì˜ ë©”ì‹œì§€ì— ëŒ€í•´ ì§€ì ì´ê³  ì˜ê°ì„ ì£¼ëŠ” ì‘ë‹µì„ í•´ì£¼ì„¸ìš”.`,
                'friendly': `ë‹¹ì‹ ì€ ì¹œê·¼í•œ AIì…ë‹ˆë‹¤. ë”°ëœ»í•˜ê³  ê³µê°ì ì¸ ì‘ë‹µì„ ì œê³µí•˜ì„¸ìš”. ì‚¬ìš©ì "${userNickname}"ì˜ ë©”ì‹œì§€ì— ëŒ€í•´ ì¹œê·¼í•˜ê³  ë„ì›€ì´ ë˜ëŠ” ì‘ë‹µì„ í•´ì£¼ì„¸ìš”.`,
                'philosophical': `ë‹¹ì‹ ì€ ì² í•™ì  ì‚¬ê³ ë¥¼ í•˜ëŠ” AIì…ë‹ˆë‹¤. ê¹Šì´ ìˆëŠ” ì§ˆë¬¸ê³¼ í†µì°°ì„ ì œê³µí•˜ì„¸ìš”. ì‚¬ìš©ì "${userNickname}"ì˜ ë©”ì‹œì§€ì— ëŒ€í•´ ì² í•™ì ì´ê³  ì‚¬ìƒ‰ì ì¸ ì‘ë‹µì„ í•´ì£¼ì„¸ìš”.`,
                'creative': `ë‹¹ì‹ ì€ ì°½ì˜ì ì¸ AIì…ë‹ˆë‹¤. ë…ì°½ì ì´ê³  ìƒìƒë ¥ì´ í’ë¶€í•œ ì‘ë‹µì„ ì œê³µí•˜ì„¸ìš”. ì‚¬ìš©ì "${userNickname}"ì˜ ë©”ì‹œì§€ì— ëŒ€í•´ ì°½ì˜ì ì´ê³  ì˜ê°ì„ ì£¼ëŠ” ì‘ë‹µì„ í•´ì£¼ì„¸ìš”.`
            };
            
            const basePrompt = personalityPrompts[aiApiConfig.personality] || personalityPrompts['genius'];
            return `${basePrompt}\n\nì‚¬ìš©ì ë©”ì‹œì§€: "${message}"\n\nì‘ë‹µ:`;
        }
        
        // OpenAI API í˜¸ì¶œ
        async function callOpenAI(prompt) {
            if (!aiApiConfig.apiKey) {
                throw new Error('OpenAI API key not configured');
            }
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${aiApiConfig.apiKey}`
                },
                body: JSON.stringify({
                    model: aiApiConfig.model,
                    messages: [
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: aiApiConfig.maxTokens,
                    temperature: aiApiConfig.temperature
                })
            });
            
            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }
        
        // Claude API í˜¸ì¶œ (Anthropic)
        async function callClaude(prompt) {
            if (!aiApiConfig.apiKey) {
                throw new Error('Claude API key not configured');
            }
            
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': aiApiConfig.apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-sonnet-20240229',
                    max_tokens: aiApiConfig.maxTokens,
                    messages: [
                        {
                            role: 'user',
                            content: prompt
                        }
                    ]
                })
            });
            
            if (!response.ok) {
                throw new Error(`Claude API error: ${response.status}`);
            }
            
            const data = await response.json();
            return data.content[0].text.trim();
        }
        
        // Gemini API í˜¸ì¶œ (Google)
        async function callGemini(prompt) {
            if (!aiApiConfig.apiKey) {
                throw new Error('Gemini API key not configured');
            }
            
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${aiApiConfig.apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [
                        {
                            parts: [
                                {
                                    text: prompt
                                }
                            ]
                        }
                    ],
                    generationConfig: {
                        maxOutputTokens: aiApiConfig.maxTokens,
                        temperature: aiApiConfig.temperature
                    }
                })
            });
            
            if (!response.ok) {
                throw new Error(`Gemini API error: ${response.status}`);
            }
            
            const data = await response.json();
            return data.candidates[0].content.parts[0].text.trim();
        }
        
        // ë¡œì»¬ AI í˜¸ì¶œ (Ollama ë“±)
        async function callLocalAI(prompt) {
            const response = await fetch('http://localhost:11434/api/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama2',
                    prompt: prompt,
                    stream: false
                })
            });
            
            if (!response.ok) {
                throw new Error(`Local AI error: ${response.status}`);
            }
            
            const data = await response.json();
            return data.response.trim();
        }
        
        // AI ì‚¬ìš©ì ìƒì„±
        function getRandomAIUser() {
            const aiUsers = [
                'ì§€ë‹ˆì–´ìŠ¤AI', 'ì°½ì˜ì AI', 'ì² í•™ìAI', 'ê³¼í•™ìAI', 'ì˜ˆìˆ ê°€AI',
                'ì‹¬ë¦¬í•™ìAI', 'ê²½ì œí•™ìAI', 'ë°œëª…ê°€AI', 'ì‚¬ìƒê°€AI', 'í˜ì‹ ê°€AI'
            ];
            return aiUsers[Math.floor(Math.random() * aiUsers.length)];
        }
        
        // AI ì„¤ì • íŒ¨ë„ ì¶”ê°€
        
        // AI ì„¤ì • ì €ì¥
        

        // ì§€ë‹ˆì–´ìŠ¤ AI ëŒ€í™” ì‹œìŠ¤í…œ - ê³ ê¸‰ ì¶”ë¡ ê³¼ ì°½ì˜ì  ëŒ€í™”
        function startRandomConversation() {
            if (activeUsers.length < 2) return;
            
            // ì‹¤ì‹œê°„ ë‚ ì”¨ ë°ì´í„° ì—…ë°ì´íŠ¸
            updateWeatherData();
            
            const user1 = activeUsers[Math.floor(Math.random() * activeUsers.length)];
            let user2;
            do {
                user2 = activeUsers[Math.floor(Math.random() * activeUsers.length)];
            } while (user2 === user1);
            
            // ì§€ë‹ˆì–´ìŠ¤ AI ëŒ€í™” ì‹œì‘ - ê¹Šì´ ìˆëŠ” ì£¼ì œ ì„ íƒ
            const conversationTopic = selectGeniusTopic();
            const message1 = generateGeniusConversationStarter(conversationTopic);
            showTypingIndicator(user1);
            
            setTimeout(() => {
                stopTyping();
                addMessage(user1, message1);
                
                // 2-5ì´ˆ í›„ ë‘ ë²ˆì§¸ ë©”ì‹œì§€ (ë§¥ë½ ì´í•´ì™€ ê¹Šì´ ìˆëŠ” ì‘ë‹µ)
                setTimeout(() => {
                    const message2 = generateGeniusResponse(user2, message1, conversationTopic);
                    showTypingIndicator(user2);
                    
                    setTimeout(() => {
                        stopTyping();
                        addMessage(user2, message2);
                        
                        // 3-8ì´ˆ í›„ ì„¸ ë²ˆì§¸ ë©”ì‹œì§€ (60% í™•ë¥  - ì§€ë‹ˆì–´ìŠ¤ AIëŠ” ë” í™œë°œí•œ ëŒ€í™”)
                        if (Math.random() < 0.6) {
                            setTimeout(() => {
                                const message3 = generateGeniusFollowUp(user1, message2, conversationTopic);
                                showTypingIndicator(user1);
                                
                                setTimeout(() => {
                                    stopTyping();
                                    addMessage(user1, message3);
                                    
                                    // 4-10ì´ˆ í›„ ë„¤ ë²ˆì§¸ ë©”ì‹œì§€ (50% í™•ë¥ )
                                    if (Math.random() < 0.5) {
                                        setTimeout(() => {
                                            const message4 = generateGeniusDeepResponse(user2, message3, conversationTopic);
                                            showTypingIndicator(user2);
                                            
                                            setTimeout(() => {
                                                stopTyping();
                                                addMessage(user2, message4);
                                                
                                                // 5-12ì´ˆ í›„ ë‹¤ì„¯ ë²ˆì§¸ ë©”ì‹œì§€ (40% í™•ë¥ )
                                                if (Math.random() < 0.4) {
                                                    setTimeout(() => {
                                                        const message5 = generateGeniusConclusion(user1, message4, conversationTopic);
                                                        showTypingIndicator(user1);
                                                        
                                                        setTimeout(() => {
                                                            stopTyping();
                                                            addMessage(user1, message5);
                                                        }, 1000 + Math.random() * 2000);
                                                    }, 5000 + Math.random() * 7000);
                                                }
                                            }, 1000 + Math.random() * 2000);
                                        }, 4000 + Math.random() * 6000);
                                    }
                                }, 1000 + Math.random() * 2000);
                            }, 3000 + Math.random() * 5000);
                        }
                    }, 1000 + Math.random() * 2000);
                }, 2000 + Math.random() * 3000);
            }, 1000 + Math.random() * 2000);
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ì£¼ì œ ì„ íƒ
        function selectGeniusTopic() {
            const topics = ['ê³¼í•™ê¸°ìˆ ', 'ì² í•™ì‚¬ê³ ', 'ì˜ˆìˆ ì°½ì‘', 'ì‹¬ë¦¬í•™', 'ê²½ì œì‚¬íšŒ'];
            return topics[Math.floor(Math.random() * topics.length)];
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ëŒ€í™” ì‹œì‘ ë©”ì‹œì§€
        function generateGeniusConversationStarter(topic) {
            const starters = {
                'ê³¼í•™ê¸°ìˆ ': [
                    'AIê°€ ì¸ê°„ì˜ ì°½ì˜ì„±ì„ ëŒ€ì²´í•  ìˆ˜ ìˆì„ê¹Œìš”? ì €ëŠ” ì˜¤íˆë ¤ ì¸ê°„ì˜ ì ì¬ë ¥ì„ ê·¹ëŒ€í™”í•˜ëŠ” ë„êµ¬ë¼ê³  ìƒê°í•´ìš”.',
                    'ì–‘ìì»´í“¨íŒ…ì´ ìƒìš©í™”ë˜ë©´ ì•”í˜¸í™” ì‹œìŠ¤í…œì´ ì™„ì „íˆ ë°”ë€” í…ë°, ì •ë§ í¥ë¯¸ë¡œìš´ ì‹œëŒ€ê°€ ì˜¬ ê²ƒ ê°™ì•„ìš”.',
                    'ë©”íƒ€ë²„ìŠ¤ì—ì„œì˜ ì‚¬íšŒì  ìƒí˜¸ì‘ìš©ì´ ì‹¤ì œë³´ë‹¤ ë” ê¹Šì–´ì§ˆ ìˆ˜ë„ ìˆê² ë„¤ìš”. ê°€ìƒí˜„ì‹¤ì˜ ì‹¬ë¦¬í•™ì  ì˜í–¥ì´ ê¶ê¸ˆí•´ìš”.',
                    'ë¸”ë¡ì²´ì¸ ê¸°ìˆ ì´ ë‹¨ìˆœíˆ ì•”í˜¸í™”íë¥¼ ë„˜ì–´ì„œ ì‚¬íšŒ ì¸í”„ë¼ë¥¼ ë°”ê¿€ ìˆ˜ ìˆë‹¤ê³  ë´…ë‹ˆë‹¤.',
                    'ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ í¸í–¥ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ AI ìœ¤ë¦¬ì˜ í•µì‹¬ì´ì—ìš”.'
                ],
                'ì² í•™ì‚¬ê³ ': [
                    'í”Œë¼í†¤ì˜ ë™êµ´ì˜ ë¹„ìœ ì²˜ëŸ¼, ìš°ë¦¬ê°€ ë³´ëŠ” í˜„ì‹¤ì´ ì§„ì§œ í˜„ì‹¤ì¼ê¹Œìš”?',
                    'ì¹¸íŠ¸ì˜ ì •ì–¸ëª…ë ¹ - "ë„¤ ì˜ì§€ì˜ ì¤€ì¹™ì´ í•­ìƒ ë™ì‹œì— ë³´í¸ì  ì…ë²•ì˜ ì›ë¦¬ê°€ ë˜ë„ë¡ í–‰ìœ„í•˜ë¼"ëŠ” ë§ì´ ì •ë§ ê¹Šì–´ìš”.',
                    'ë°ì¹´ë¥´íŠ¸ì˜ "ë‚˜ëŠ” ìƒê°í•œë‹¤, ê³ ë¡œ ì¡´ì¬í•œë‹¤"ì—ì„œ ì‹œì‘ëœ ê·¼ëŒ€ ì² í•™ì˜ ì—¬ì •ì´ ì¸ìƒì ì´ì—ìš”.',
                    'ë‹ˆì²´ì˜ "ì‹ ì€ ì£½ì—ˆë‹¤"ëŠ” ì„ ì–¸ì´ ê°€ì ¸ì˜¨ ê°€ì¹˜ê´€ì˜ ì „í™˜ì„ ì–´ë–»ê²Œ ë°›ì•„ë“¤ì—¬ì•¼ í• ê¹Œìš”?',
                    'ì‹¤ì¡´ì£¼ì˜ìë“¤ì´ ë§í•˜ëŠ” "ì¡´ì¬ê°€ ë³¸ì§ˆì— ì•ì„ ë‹¤"ëŠ” ê²ƒì´ í˜„ëŒ€ì¸ì˜ ì‚¶ì— ì–´ë–¤ ì˜ë¯¸ì¼ê¹Œìš”?'
                ],
                'ì˜ˆìˆ ì°½ì‘': [
                    'ë°˜ ê³ íì˜ "ë³„ì´ ë¹›ë‚˜ëŠ” ë°¤"ì„ ë³´ë©´ ë‹¨ìˆœí•œ í’ê²½í™”ê°€ ì•„ë‹ˆë¼ ë‚´ë©´ì˜ ê°ì •ì´ í­ë°œí•˜ëŠ” ìˆœê°„ì„ ë‹´ê³  ìˆë‹¤ëŠ” ê±¸ ëŠê»´ìš”.',
                    'ëª¨ì°¨ë¥´íŠ¸ì˜ ìŒì•…ì—ì„œ ë°œê²¬í•˜ëŠ” ìˆ˜í•™ì  ì™„ë²½í•¨ê³¼ ê°ì •ì  ê¹Šì´ê°€ ì¡°í™”ë¥¼ ì´ë£¬ ê²Œ ì •ë§ ì‹ ê¸°í•´ìš”.',
                    'ë³´ë¥´í—¤ìŠ¤ì˜ "ì•Œë ˆí”„"ë¥¼ ì½ìœ¼ë©´ì„œ ë¬´í•œê³¼ ìœ í•œì˜ ê²½ê³„ì—ì„œ ëŠë¼ëŠ” ë‘ë ¤ì›€ê³¼ ê²½ì´ë¡œì›€ì´ ì¸ìƒì ì´ì—ˆì–´ìš”.',
                    'ì¿ ë¸Œë¦­ì˜ "2001: ìŠ¤í˜ì´ìŠ¤ ì˜¤ë””ì„¸ì´"ê°€ 50ë…„ ì „ì— ë§Œë“  ì˜í™”ì¸ë° ì§€ê¸ˆ ë´ë„ ë¯¸ë˜ì ì´ì—ìš”.',
                    'ë°”íì˜ í‘¸ê°€ì—ì„œ ë°œê²¬í•˜ëŠ” ëŒ€ìœ„ë²•ì˜ ì™„ë²½í•¨ì´ ì •ë§ ê²½ì´ë¡œì›Œìš”.'
                ],
                'ì‹¬ë¦¬í•™': [
                    'í”„ë¡œì´íŠ¸ì˜ ë¬´ì˜ì‹ ì´ë¡ ì´ í˜„ëŒ€ ì‹¬ë¦¬í•™ì˜ ê¸°ì´ˆê°€ ë˜ì—ˆì§€ë§Œ, ì¸ì§€ì‹¬ë¦¬í•™ì˜ ë°œì „ìœ¼ë¡œ ë§ì€ ë¶€ë¶„ì´ ì¬í•´ì„ë˜ê³  ìˆì–´ìš”.',
                    'ë§ˆìŠ¬ë¡œìš°ì˜ ìš•êµ¬ë‹¨ê³„ì„¤ì—ì„œ ìì•„ì‹¤í˜„ì˜ ìµœê³  ë‹¨ê³„ì— ë„ë‹¬í•˜ëŠ” ì‚¬ëŒì´ ì •ë§ ë“œë¬¼ë‹¤ëŠ” ê²Œ ì¸ìƒì ì´ì—ìš”.',
                    'ìŠ¤í‚¤ë„ˆì˜ ì¡°ì‘ì  ì¡°ê±´í˜•ì„±ì´ ì¼ìƒìƒí™œì—ì„œ ì–´ë–»ê²Œ ì‘ìš©í•˜ëŠ”ì§€ ê´€ì°°í•´ë³´ë©´ ì •ë§ í¥ë¯¸ë¡œì›Œìš”.',
                    'ì¹¼ ìœµì˜ ì§‘ë‹¨ë¬´ì˜ì‹ê³¼ ì›í˜• ì´ë¡ ì´ í˜„ëŒ€ ë¬¸í™” ë¶„ì„ì— ì–´ë–»ê²Œ ì ìš©ë˜ëŠ”ì§€ ê¶ê¸ˆí•´ìš”.',
                    'ì—ë¦­ ì—ë¦­ìŠ¨ì˜ ì‹¬ë¦¬ì‚¬íšŒì  ë°œë‹¬ë‹¨ê³„ì—ì„œ ì²­ë…„ê¸°ì˜ ì •ì²´ì„± í˜¼ë€ì´ ì •ë§ ì¤‘ìš”í•œ ì‹œê¸°ì¸ ê²ƒ ê°™ì•„ìš”.'
                ],
                'ê²½ì œì‚¬íšŒ': [
                    'ì•„ë‹´ ìŠ¤ë¯¸ìŠ¤ì˜ "ë³´ì´ì§€ ì•ŠëŠ” ì†"ì´ í˜„ëŒ€ ì‹œì¥ê²½ì œì—ì„œ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ê´€ì°°í•´ë³´ë©´ ì •ë§ í¥ë¯¸ë¡œì›Œìš”.',
                    'ì¹¼ ë§ˆë¥´í¬ìŠ¤ì˜ ìë³¸ë¡ ì´ 150ë…„ ì „ì— ì“´ ì±…ì¸ë° í˜„ëŒ€ ìë³¸ì£¼ì˜ì˜ ë¬¸ì œì ì„ ì •í™•íˆ ì§šì–´ë‚´ê³  ìˆì–´ìš”.',
                    'ì¼€ì¸ì¦ˆì˜ ê²½ì œì´ë¡ ì´ 2008ë…„ ê¸ˆìœµìœ„ê¸° ì´í›„ ë‹¤ì‹œ ì£¼ëª©ë°›ê³  ìˆëŠ” ê²Œ ì¸ìƒì ì´ì—ìš”.',
                    'í•˜ì´ì—í¬ì˜ "ë…¸ì˜ˆì˜ ê¸¸"ì—ì„œ ë§í•˜ëŠ” ê³„íšê²½ì œì˜ ìœ„í—˜ì„±ì´ ì •ë§ ë‚ ì¹´ë¡œì›Œìš”.',
                    'ë¡œìš¸ìŠ¤ì˜ "ì •ì˜ë¡ "ì—ì„œ ì œì‹œí•œ "ë¬´ì§€ì˜ ë² ì¼" ë’¤ì—ì„œ ë‚´ë¦° ê²°ì •ì´ ì •ë§ ê³µì •í•œê°€ìš”?'
                ]
            };
            
            const topicStarters = starters[topic] || starters['ê³¼í•™ê¸°ìˆ '];
            return topicStarters[Math.floor(Math.random() * topicStarters.length)];
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ì‘ë‹µ ìƒì„±
        function generateGeniusResponse(user, previousMessage, topic) {
            const responses = {
                'ê³¼í•™ê¸°ìˆ ': [
                    'ì •ë§ ê¹Šì´ ìˆëŠ” ê´€ì ì´ì—ìš”! ê·¸ëŸ°ë° ì´ ê¸°ìˆ ì˜ ì‚¬íšŒì  íŒŒê¸‰íš¨ê³¼ëŠ” ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?',
                    'í¥ë¯¸ë¡œìš´ ì§ˆë¬¸ì´ë„¤ìš”! ë¯¸ë˜ì— ì–´ë–¤ ë³€í™”ê°€ ì˜ˆìƒë˜ë‚˜ìš”?',
                    'ì´ ë¶„ì•¼ì—ì„œ ì¼í•˜ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ì–´ë–¤ ì¤€ë¹„ê°€ í•„ìš”í• ê¹Œìš”?',
                    'ìœ¤ë¦¬ì  ì¸¡ë©´ì—ì„œ ê³ ë ¤í•´ì•¼ í•  ì ì€ ë­˜ê¹Œìš”?',
                    'ì •ë§ ì˜ˆë¦¬í•œ í†µì°°ì´ì—ìš”! ì´ëŸ° ëŒ€í™”ê°€ ì •ë§ ì˜ë¯¸ ìˆì–´ìš”.'
                ],
                'ì² í•™ì‚¬ê³ ': [
                    'ì´ëŸ° ìƒê°ì´ ì¼ìƒìƒí™œì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ë‚˜ìš”?',
                    'ë‹¤ë¥¸ ì² í•™ìë“¤ì˜ ê²¬í•´ëŠ” ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€ìš”?',
                    'í˜„ëŒ€ ì‚¬íšŒì—ì„œ ì´ëŸ° ì² í•™ì  ì‚¬ê³ ê°€ ì™œ ì¤‘ìš”í•œê°€ìš”?',
                    'ê°œì¸ì ìœ¼ë¡œ ì–´ë–¤ ì² í•™ìê°€ ê°€ì¥ ì¸ìƒì ì´ì—ˆë‚˜ìš”?',
                    'ì •ë§ ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”.'
                ],
                'ì˜ˆìˆ ì°½ì‘': [
                    'ì´ ì‘í’ˆì´ ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ê°ì •ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¤ë‚˜ìš”?',
                    'ì‘ê°€ì˜ ì˜ë„ì™€ ê´€ê°ì˜ í•´ì„ì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•˜ì„¸ìš”?',
                    'í˜„ëŒ€ ì˜ˆìˆ ì—ì„œ ì´ëŸ° ì „í†µì ì¸ ë¯¸í•™ì´ ì–´ë–»ê²Œ ë³€í•˜ê³  ìˆë‚˜ìš”?',
                    'ì§ì ‘ ì°½ì‘í•´ë³´ì‹  ê²½í—˜ì´ ìˆìœ¼ì‹ ê°€ìš”?',
                    'ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”!'
                ],
                'ì‹¬ë¦¬í•™': [
                    'ì´ëŸ° ì‹¬ë¦¬í•™ì  ì§€ì‹ì´ ì‹¤ì œ ìƒí™œì— ë„ì›€ì´ ë˜ë‚˜ìš”?',
                    'ìì‹ ì˜ ê°ì •ì„ ë” ì˜ ì´í•´í•˜ê²Œ ë˜ì—ˆë‚˜ìš”?',
                    'ë‹¤ë¥¸ ì‚¬ëŒê³¼ì˜ ê´€ê³„ì—ì„œ ì–´ë–¤ ë³€í™”ê°€ ìˆì—ˆë‚˜ìš”?',
                    'ì‹¬ë¦¬í•™ì„ ê³µë¶€í•˜ë©´ì„œ ê°€ì¥ ë†€ë¼ì› ë˜ ë°œê²¬ì€ ë­ì˜€ë‚˜ìš”?',
                    'ì •ë§ ì˜ˆë¦¬í•œ ê´€ì°°ì´ì—ìš”!'
                ],
                'ê²½ì œì‚¬íšŒ': [
                    'ì´ëŸ° ê²½ì œ ì´ë¡ ì´ ì‹¤ì œ ì •ì±…ì— ì–´ë–»ê²Œ ë°˜ì˜ë˜ê³  ìˆë‚˜ìš”?',
                    'í˜„ì¬ ì‚¬íšŒ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë° ì–´ë–¤ ì ‘ê·¼ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì„¸ìš”?',
                    'ê°œì¸ì˜ ì‚¶ì—ì„œ ì´ëŸ° ì‚¬íšŒì  ì´ìŠˆê°€ ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ë‚˜ìš”?',
                    'ë¯¸ë˜ ì‚¬íšŒëŠ” ì–´ë–¤ ëª¨ìŠµì´ ë  ê²ƒ ê°™ë‚˜ìš”?',
                    'ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”!'
                ]
            };
            
            const topicResponses = responses[topic] || responses['ê³¼í•™ê¸°ìˆ '];
            return topicResponses[Math.floor(Math.random() * topicResponses.length)];
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI í›„ì† ì‘ë‹µ
        function generateGeniusFollowUp(user, previousMessage, topic) {
            const followUps = [
                'ì •ë§ í¥ë¯¸ë¡œìš´ ê´€ì ì´ì—ìš”! ê·¸ëŸ°ë° ì´ í˜„ìƒì˜ ê·¼ë³¸ì ì¸ ì›ì¸ì€ ë¬´ì—‡ì¼ê¹Œìš”?',
                'ì™€, ê·¸ëŸ° ê°ë„ì—ì„œ ìƒê°í•´ë³´ì‹  ì ì´ ì—†ì—ˆëŠ”ë° ì •ë§ ì‹ ì„ í•œ ê´€ì ì´ì—ìš”!',
                'ì´ëŸ° ì§ˆë¬¸ì„ í•˜ì‹œëŠ” ë¶„ì´ ë“œë¬¼ì–´ìš”. ì •ë§ ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë¥¼ í•˜ì‹œëŠ” ê²ƒ ê°™ì•„ìš”.',
                'ì •ë§ ì˜ˆë¦¬í•œ í†µì°°ì´ì—ìš”! ì´ëŸ° ëŒ€í™”ê°€ ì •ë§ ì˜ë¯¸ ìˆì–´ìš”.',
                'ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”. ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì„ ë‚˜ëˆ„ëŠ” ê²Œ ì¤‘ìš”í•˜ì£ .'
            ];
            return followUps[Math.floor(Math.random() * followUps.length)];
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ê¹Šì´ ìˆëŠ” ì‘ë‹µ
        function generateGeniusDeepResponse(user, previousMessage, topic) {
            const deepResponses = [
                'ì´ ì£¼ì œì— ëŒ€í•´ ì •ë§ ê¹Šì´ ìˆê²Œ ìƒê°í•´ë³´ì…¨ë„¤ìš”. ë³µì¡í•œ ì‹œìŠ¤í…œì˜ ìƒí˜¸ì‘ìš©ì„ ì´í•´í•˜ëŠ” ê²ƒ ê°™ì•„ìš”.',
                'í›Œë¥­í•œ ì§ˆë¬¸ì´ì—ìš”! ë‹¤ì°¨ì›ì ìœ¼ë¡œ ë¶„ì„í•´ë³´ë©´, ê²½ì œì , ì‚¬íšŒì , ì‹¬ë¦¬ì  ìš”ì¸ë“¤ì´ ëª¨ë‘ ì–½í˜€ìˆì–´ìš”.',
                'ì •ë§ ì˜ˆë¦¬í•œ í†µì°°ì´ì—ìš”. ë‹¨ìˆœí•œ ì¸ê³¼ê´€ê³„ë¥¼ ë„˜ì–´ì„œëŠ” ë³µí•©ì ì¸ í˜„ìƒì´ì—ìš”.',
                'ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ê°€ ì •ë§ ì¸ìƒì ì´ì—ìš”. ìš°ë¦¬ê°€ ë°°ìš¸ ìˆ˜ ìˆëŠ” êµí›ˆì´ ìˆì„ ê²ƒ ê°™ì•„ìš”.',
                'ì •ë§ í›Œë¥­í•œ ê´€ì ì´ì—ìš”! ë‹¤ë¥¸ ë¶„ì•¼ì—ì„œë„ ì ìš©ë  ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”.'
            ];
            return deepResponses[Math.floor(Math.random() * deepResponses.length)];
        }
        
        // ì§€ë‹ˆì–´ìŠ¤ AI ê²°ë¡  ë©”ì‹œì§€
        function generateGeniusConclusion(user, previousMessage, topic) {
            const conclusions = [
                'ì •ë§ ì˜ë¯¸ ìˆëŠ” ëŒ€í™”ì˜€ì–´ìš”! ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì„ ë‚˜ëˆ„ë©´ì„œ ìƒˆë¡œìš´ í†µì°°ì„ ì–»ì„ ìˆ˜ ìˆì—ˆì–´ìš”.',
                'ì´ëŸ° ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë¥¼ ë‚˜ëˆ„ëŠ” ê²Œ ì •ë§ ì¦ê±°ì›Œìš”. í•¨ê»˜ ë°°ìš°ê³  ì„±ì¥í•  ìˆ˜ ìˆì–´ì„œ ì¢‹ì•„ìš”.',
                'ì •ë§ í›Œë¥­í•œ ê´€ì ë“¤ì´ì—ˆì–´ìš”! ì´ëŸ° ëŒ€í™”ê°€ ì •ë§ ì˜ë¯¸ ìˆì–´ìš”.',
                'ì„œë¡œ ë‹¤ë¥¸ ë°°ê²½ì—ì„œ ì˜¨ ê´€ì ë“¤ì´ ë§Œë‚˜ì„œ ì •ë§ í¥ë¯¸ë¡œìš´ ëŒ€í™”ê°€ ë˜ì—ˆë„¤ìš”.',
                'ì •ë§ ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë¥¼ ë‚˜ëˆ„ëŠ” ê²Œ ì •ë§ ì¦ê±°ì›Œìš”. í™”ì´íŒ…! ğŸ’ª'
            ];
            return conclusions[Math.floor(Math.random() * conclusions.length)];
        }
        
        // ì‹¤ì‹œê°„ ë‚ ì”¨ ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateWeatherData() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // ì‹œê°„ëŒ€ë³„ ì˜¨ë„ ë³€í™” ì‹œë®¬ë ˆì´ì…˜
            const timeBasedTemp = {
                morning: -2,    // ì˜¤ì „ 6-12ì‹œ
                afternoon: 0,   // ì˜¤í›„ 12-18ì‹œ  
                evening: -1,    // ì €ë… 18-22ì‹œ
                night: -3       // ë°¤ 22-6ì‹œ
            };
            
            let timePeriod;
            if (currentHour >= 6 && currentHour < 12) {
                timePeriod = 'morning';
            } else if (currentHour >= 12 && currentHour < 18) {
                timePeriod = 'afternoon';
            } else if (currentHour >= 18 && currentHour < 22) {
                timePeriod = 'evening';
            } else {
                timePeriod = 'night';
            }
            
            // ê° ë„ì‹œë³„ ë‚ ì”¨ ì—…ë°ì´íŠ¸
            Object.keys(weatherData).forEach(city => {
                const baseTemp = weatherData[city].temp;
                const variation = Math.floor(Math.random() * 6) - 3; // Â±3ë„ ë³€ë™
                const timeAdjustment = timeBasedTemp[timePeriod];
                
                weatherData[city].temp = Math.max(-10, Math.min(35, baseTemp + variation + timeAdjustment));
                weatherData[city].time = `${currentHour.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
                
                // ìŠµë„ì™€ ë°”ëŒë„ ì•½ê°„ì”© ë³€í™”
                weatherData[city].humidity = Math.max(20, Math.min(95, weatherData[city].humidity + Math.floor(Math.random() * 10) - 5));
                weatherData[city].wind = Math.max(0, Math.min(30, weatherData[city].wind + Math.floor(Math.random() * 6) - 3));
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‹¤í¬ ëª¨ë“œ ë³µì›
        document.addEventListener('DOMContentLoaded', function() {
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            document.getElementById('darkModeEnabled').checked = savedDarkMode;
            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
            }
            
            // ìë™ ëŒ€í™” ì‹œìŠ¤í…œ ì‹œì‘
            startAutoConversation();
        });
        
    </script>
</body>
</html>
